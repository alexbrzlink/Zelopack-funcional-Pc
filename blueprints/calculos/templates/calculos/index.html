{% extends "base.html" %}

{% block title %}Calculadora de Laboratório | ZeloPack{% endblock %}

{% block head_extra %}
<style>
    .calculator-container {
        background-color: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }
    
    .calculator-container:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        transform: translateY(-5px);
    }
    
    .calculator-title {
        background-color: #0d6efd;
        color: white;
        padding: 10px 15px;
        border-radius: 6px;
        margin-bottom: 20px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .calculator-title:hover {
        background-color: #0b5ed7;
    }
    
    .calculator-body {
        display: none;
        padding: 15px 10px;
        background-color: white;
        border-radius: 8px;
        border: 1px solid #dee2e6;
    }
    
    .calculator-body.active {
        display: block;
    }
    
    .form-group {
        margin-bottom: 15px;
    }
    
    .form-label {
        font-weight: 500;
        margin-bottom: 5px;
    }
    
    .form-control {
        border-radius: 4px;
    }
    
    .btn-calculate {
        background-color: #28a745;
        border: none;
        color: white;
        padding: 8px 20px;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
    }
    
    .btn-calculate:hover {
        background-color: #218838;
    }
    
    .result-box {
        margin-top: 15px;
        padding: 15px;
        background-color: #f0f8ff;
        border: 1px solid #b8daff;
        border-radius: 6px;
        display: none;
    }
    
    .result-value {
        font-weight: bold;
        font-size: 1.2rem;
        color: #0d6efd;
    }
    
    .result-unit {
        font-size: 0.9rem;
        color: #6c757d;
    }
    
    .calculation-description {
        margin-bottom: 15px;
        color: #495057;
        font-style: italic;
    }
    
    .category-header {
        background-color: #343a40;
        color: white;
        padding: 12px 15px;
        border-radius: 6px;
        margin: 30px 0 20px;
        font-size: 1.2rem;
    }
    
    .calculator-icon {
        margin-right: 10px;
        font-size: 1.1rem;
    }
    
    .error-message {
        color: #dc3545;
        margin-top: 5px;
        font-size: 0.9rem;
        display: none;
    }
    
    .formula-text {
        background: #f8f9fa;
        padding: 8px 12px;
        border-radius: 4px;
        border-left: 3px solid #0d6efd;
        font-family: 'Courier New', monospace;
        margin: 10px 0 15px;
    }
    
    .pulse {
        animation: pulse-animation 0.5s;
    }
    
    @keyframes pulse-animation {
        0% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.05);
        }
        100% {
            transform: scale(1);
        }
    }
    
    .action-buttons {
        display: flex;
        gap: 10px;
        margin-top: 15px;
    }
    
    .action-button {
        flex: 1;
        text-align: center;
        padding: 10px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .action-button.copy {
        background-color: #6c757d;
        color: white;
    }
    
    .action-button.reset {
        background-color: #dc3545;
        color: white;
    }
    
    .action-button:hover {
        opacity: 0.9;
        transform: translateY(-2px);
    }
    
    .info-icon {
        color: #17a2b8;
        cursor: pointer;
        margin-left: 5px;
    }
    
    .formula-box {
        background-color: #f8f9fa;
        border-left: 3px solid #0d6efd;
        padding: 10px;
        margin: 10px 0;
        font-size: 0.9rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <h1 class="mb-4">Calculadora de Laboratório</h1>
            <p class="lead">Utilize as calculadoras abaixo para realizar cálculos importantes para análises de laboratório e processo de produção.</p>
            
            <div class="category-header">
                <i class="fas fa-industry"></i> Cálculos de Produção e Peso
            </div>
            
            <!-- Calculadora 1: Produção 200 -->
            <div class="calculator-container">
                <div class="calculator-title" onclick="toggleCalculator('producao200')">
                    <span><i class="fas fa-balance-scale calculator-icon"></i> Produção 200g</span>
                    <i class="fas fa-chevron-down" id="icon-producao200"></i>
                </div>
                <div class="calculator-body" id="producao200">
                    <div class="calculation-description">
                        Determina o peso líquido de embalagens de 200g, subtraindo a tara (peso da embalagem) do peso bruto.
                    </div>
                    <div class="formula-box">
                        <strong>Fórmula:</strong> Peso Líquido = Peso Bruto - Tara
                    </div>
                    <form id="form-producao200">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label" for="peso_bruto_200">Peso Bruto (g):</label>
                                    <input type="number" class="form-control" id="peso_bruto_200" placeholder="Digite o peso bruto" step="0.01" required>
                                    <div class="error-message" id="error-peso_bruto_200">Valor inválido</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label" for="tara_200">Tara (g):</label>
                                    <input type="number" class="form-control" id="tara_200" placeholder="Digite a tara" step="0.01" required>
                                    <div class="error-message" id="error-tara_200">Valor inválido</div>
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-3">
                            <button type="button" class="btn btn-calculate" onclick="calculate('producao_200')">
                                <i class="fas fa-calculator"></i> Calcular
                            </button>
                        </div>
                        <div class="result-box" id="result-producao_200">
                            <div class="row">
                                <div class="col-md-12 text-center">
                                    <div class="result-label">Peso Líquido:</div>
                                    <div class="result-value" id="result-value-producao_200">0</div>
                                    <div class="result-unit">gramas</div>
                                </div>
                            </div>
                            <div class="action-buttons">
                                <div class="action-button copy" onclick="copyResult('result-value-producao_200', 'g')">
                                    <i class="fas fa-copy"></i> Copiar
                                </div>
                                <div class="action-button reset" onclick="resetCalculator('form-producao200', 'result-producao_200')">
                                    <i class="fas fa-redo"></i> Limpar
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Calculadora 2: Produção Litro -->
            <div class="calculator-container">
                <div class="calculator-title" onclick="toggleCalculator('producaoLitro')">
                    <span><i class="fas fa-tint calculator-icon"></i> Volume de Produção</span>
                    <i class="fas fa-chevron-down" id="icon-producaoLitro"></i>
                </div>
                <div class="calculator-body" id="producaoLitro">
                    <div class="calculation-description">
                        Calcula o volume final de produção com base no peso e densidade do produto.
                    </div>
                    <div class="formula-box">
                        <strong>Fórmula:</strong> Volume (L) = Massa (kg) / Densidade (kg/L)
                    </div>
                    <form id="form-producaoLitro">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label" for="peso_total">Peso Total (kg):</label>
                                    <input type="number" class="form-control" id="peso_total" placeholder="Digite o peso total" step="0.01" required>
                                    <div class="error-message" id="error-peso_total">Valor inválido</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label" for="densidade">Densidade (kg/L):</label>
                                    <input type="number" class="form-control" id="densidade" placeholder="Digite a densidade" step="0.001" required>
                                    <div class="error-message" id="error-densidade">Valor inválido</div>
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-3">
                            <button type="button" class="btn btn-calculate" onclick="calculate('producao_litro')">
                                <i class="fas fa-calculator"></i> Calcular
                            </button>
                        </div>
                        <div class="result-box" id="result-producao_litro">
                            <div class="row">
                                <div class="col-md-12 text-center">
                                    <div class="result-label">Volume Produzido:</div>
                                    <div class="result-value" id="result-value-producao_litro">0</div>
                                    <div class="result-unit">litros</div>
                                </div>
                            </div>
                            <div class="action-buttons">
                                <div class="action-button copy" onclick="copyResult('result-value-producao_litro', 'L')">
                                    <i class="fas fa-copy"></i> Copiar
                                </div>
                                <div class="action-button reset" onclick="resetCalculator('form-producaoLitro', 'result-producao_litro')">
                                    <i class="fas fa-redo"></i> Limpar
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="category-header">
                <i class="fas fa-flask"></i> Cálculos de Laboratório
            </div>
            
            <!-- Calculadora 3: Abaixar Brix -->
            <div class="calculator-container">
                <div class="calculator-title" onclick="toggleCalculator('abaixarBrix')">
                    <span><i class="fas fa-arrow-down calculator-icon"></i> Diluição para Ajuste de Brix</span>
                    <i class="fas fa-chevron-down" id="icon-abaixarBrix"></i>
                </div>
                <div class="calculator-body" id="abaixarBrix">
                    <div class="calculation-description">
                        Estima quanto de água é necessário adicionar para reduzir o Brix de uma solução até o valor desejado.
                    </div>
                    <div class="formula-box">
                        <strong>Fórmula:</strong> Volume de água (L) = (Volume inicial × Brix atual / Brix desejado) - Volume inicial
                    </div>
                    <form id="form-abaixarBrix">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label" for="brix_atual">Brix Atual:</label>
                                    <input type="number" class="form-control" id="brix_atual" placeholder="Digite o Brix atual" step="0.1" required>
                                    <div class="error-message" id="error-brix_atual">Valor inválido</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label" for="brix_desejado">Brix Desejado:</label>
                                    <input type="number" class="form-control" id="brix_desejado" placeholder="Digite o Brix desejado" step="0.1" required>
                                    <div class="error-message" id="error-brix_desejado">Valor inválido</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label" for="volume_inicial">Volume Inicial (L):</label>
                                    <input type="number" class="form-control" id="volume_inicial" placeholder="Digite o volume inicial" step="0.1" required>
                                    <div class="error-message" id="error-volume_inicial">Valor inválido</div>
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-3">
                            <button type="button" class="btn btn-calculate" onclick="calculate('abaixar_brix')">
                                <i class="fas fa-calculator"></i> Calcular
                            </button>
                        </div>
                        <div class="result-box" id="result-abaixar_brix">
                            <div class="row">
                                <div class="col-md-12 text-center">
                                    <div class="result-label">Água a Adicionar:</div>
                                    <div class="result-value" id="result-value-abaixar_brix">0</div>
                                    <div class="result-unit">litros</div>
                                </div>
                            </div>
                            <div class="action-buttons">
                                <div class="action-button copy" onclick="copyResult('result-value-abaixar_brix', 'L')">
                                    <i class="fas fa-copy"></i> Copiar
                                </div>
                                <div class="action-button reset" onclick="resetCalculator('form-abaixarBrix', 'result-abaixar_brix')">
                                    <i class="fas fa-redo"></i> Limpar
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Calculadora 4: Ratio -->
            <div class="calculator-container">
                <div class="calculator-title" onclick="toggleCalculator('ratio')">
                    <span><i class="fas fa-divide calculator-icon"></i> Ratio (Brix/Acidez)</span>
                    <i class="fas fa-chevron-down" id="icon-ratio"></i>
                </div>
                <div class="calculator-body" id="ratio">
                    <div class="calculation-description">
                        Relação entre Brix e Acidez, importante para controle de qualidade do suco. O Ratio é um indicador importante do sabor e ponto de colheita para frutas.
                    </div>
                    <div class="formula-box">
                        <strong>Fórmula:</strong> Ratio = Brix / Acidez
                    </div>
                    <form id="form-ratio">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label" for="brix_ratio">Brix:</label>
                                    <input type="number" class="form-control" id="brix_ratio" placeholder="Digite o Brix" step="0.1" required>
                                    <div class="error-message" id="error-brix_ratio">Valor inválido</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label" for="acidez_ratio">Acidez:</label>
                                    <input type="number" class="form-control" id="acidez_ratio" placeholder="Digite a acidez" step="0.01" required>
                                    <div class="error-message" id="error-acidez_ratio">Valor inválido</div>
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-3">
                            <button type="button" class="btn btn-calculate" onclick="calculate('ratio')">
                                <i class="fas fa-calculator"></i> Calcular
                            </button>
                        </div>
                        <div class="result-box" id="result-ratio">
                            <div class="row">
                                <div class="col-md-12 text-center">
                                    <div class="result-label">Ratio:</div>
                                    <div class="result-value" id="result-value-ratio">0</div>
                                </div>
                            </div>
                            <div class="action-buttons">
                                <div class="action-button copy" onclick="copyResult('result-value-ratio', '')">
                                    <i class="fas fa-copy"></i> Copiar
                                </div>
                                <div class="action-button reset" onclick="resetCalculator('form-ratio', 'result-ratio')">
                                    <i class="fas fa-redo"></i> Limpar
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Calculadora 5: Diluição de Soluções -->
            <div class="calculator-container">
                <div class="calculator-title" onclick="toggleCalculator('diluicao')">
                    <span><i class="fas fa-vial calculator-icon"></i> Diluição de Solução</span>
                    <i class="fas fa-chevron-down" id="icon-diluicao"></i>
                </div>
                <div class="calculator-body" id="diluicao">
                    <div class="calculation-description">
                        Calcula a concentração final de uma solução após diluição.
                    </div>
                    <div class="formula-box">
                        <strong>Fórmula:</strong> C₁ × V₁ = C₂ × V₂ (onde C = concentração, V = volume)
                    </div>
                    <form id="form-diluicao">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="form-label" for="conc_inicial">Concentração inicial:</label>
                                    <input type="number" class="form-control" id="conc_inicial" placeholder="Concentração inicial" step="0.01" required>
                                    <div class="error-message" id="error-conc_inicial">Valor inválido</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="form-label" for="vol_inicial">Volume inicial (mL):</label>
                                    <input type="number" class="form-control" id="vol_inicial" placeholder="Volume inicial" step="0.1" required>
                                    <div class="error-message" id="error-vol_inicial">Valor inválido</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="form-label" for="vol_final">Volume final (mL):</label>
                                    <input type="number" class="form-control" id="vol_final" placeholder="Volume final" step="0.1" required>
                                    <div class="error-message" id="error-vol_final">Valor inválido</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="form-label" for="unidade_conc">Unidade:</label>
                                    <select class="form-control" id="unidade_conc">
                                        <option value="%">Porcentagem (%)</option>
                                        <option value="mg/L">mg/L</option>
                                        <option value="g/L">g/L</option>
                                        <option value="mol/L">mol/L</option>
                                        <option value="ppm">ppm</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-3">
                            <button type="button" class="btn btn-calculate" onclick="calculate('diluicao')">
                                <i class="fas fa-calculator"></i> Calcular
                            </button>
                        </div>
                        <div class="result-box" id="result-diluicao">
                            <div class="row">
                                <div class="col-md-12 text-center">
                                    <div class="result-label">Concentração final:</div>
                                    <div class="result-value" id="result-value-diluicao">0</div>
                                    <div class="result-unit" id="result-unit-diluicao">%</div>
                                </div>
                            </div>
                            <div class="action-buttons">
                                <div class="action-button copy" onclick="copyResultWithUnit('result-value-diluicao', 'result-unit-diluicao')">
                                    <i class="fas fa-copy"></i> Copiar
                                </div>
                                <div class="action-button reset" onclick="resetCalculator('form-diluicao', 'result-diluicao')">
                                    <i class="fas fa-redo"></i> Limpar
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Calculadora 6: Conversão de unidades -->
            <div class="calculator-container">
                <div class="calculator-title" onclick="toggleCalculator('conversao')">
                    <span><i class="fas fa-exchange-alt calculator-icon"></i> Conversão de Unidades</span>
                    <i class="fas fa-chevron-down" id="icon-conversao"></i>
                </div>
                <div class="calculator-body" id="conversao">
                    <div class="calculation-description">
                        Converte entre diferentes unidades de medida frequentemente usadas no laboratório.
                    </div>
                    <form id="form-conversao">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label" for="valor_converter">Valor:</label>
                                    <input type="number" class="form-control" id="valor_converter" placeholder="Valor para converter" step="any" required>
                                    <div class="error-message" id="error-valor_converter">Valor inválido</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label" for="unidade_origem">De:</label>
                                    <select class="form-control" id="unidade_origem" onchange="updateConversionDestinations()">
                                        <option value="grupo">Selecione o grupo</option>
                                        <option value="volume">Volume</option>
                                        <option value="massa">Massa</option>
                                        <option value="temperatura">Temperatura</option>
                                        <option value="concentracao">Concentração</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label" for="unidade_destino">Para:</label>
                                    <select class="form-control" id="unidade_destino" disabled>
                                        <option value="">Selecione a unidade de origem primeiro</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-3">
                            <button type="button" class="btn btn-calculate" onclick="calculate('conversao')">
                                <i class="fas fa-calculator"></i> Converter
                            </button>
                        </div>
                        <div class="result-box" id="result-conversao">
                            <div class="row">
                                <div class="col-md-12 text-center">
                                    <div class="result-label">Resultado da conversão:</div>
                                    <div class="result-value" id="result-value-conversao">0</div>
                                    <div class="result-unit" id="result-unit-conversao"></div>
                                </div>
                            </div>
                            <div class="action-buttons">
                                <div class="action-button copy" onclick="copyResultWithUnit('result-value-conversao', 'result-unit-conversao')">
                                    <i class="fas fa-copy"></i> Copiar
                                </div>
                                <div class="action-button reset" onclick="resetCalculator('form-conversao', 'result-conversao')">
                                    <i class="fas fa-redo"></i> Limpar
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Função para alternar a visibilidade das calculadoras
    function toggleCalculator(id) {
        const element = document.getElementById(id);
        const isActive = element.classList.contains('active');
        
        // Fechar todos os calculadores
        document.querySelectorAll('.calculator-body').forEach(calc => {
            calc.classList.remove('active');
        });
        
        // Resetar todos os ícones
        document.querySelectorAll('.calculator-title i.fas.fa-chevron-down, .calculator-title i.fas.fa-chevron-up').forEach(icon => {
            if (icon.id && icon.id.startsWith('icon-')) {
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
            }
        });
        
        // Se não estava ativo, torná-lo ativo
        if (!isActive) {
            element.classList.add('active');
            const icon = document.getElementById(`icon-${id}`);
            if (icon) {
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
            }
        }
    }
    
    // Função para validar formulários
    function validateForm(formId) {
        const form = document.getElementById(formId);
        let isValid = true;
        
        // Verificar todos os campos necessários
        const inputs = form.querySelectorAll('input[required]');
        inputs.forEach(input => {
            const errorElement = document.getElementById(`error-${input.id}`);
            if (!input.value || isNaN(parseFloat(input.value))) {
                if (errorElement) {
                    errorElement.style.display = 'block';
                }
                isValid = false;
            } else {
                if (errorElement) {
                    errorElement.style.display = 'none';
                }
            }
        });
        
        return isValid;
    }
    
    // Função para formatar resultado
    function formatResult(value, decimals = 2) {
        return parseFloat(value).toFixed(decimals);
    }

    // Função para copiar resultado para área de transferência
    function copyResult(elementId, unit) {
        const element = document.getElementById(elementId);
        const text = element.textContent + (unit ? ` ${unit}` : '');
        
        navigator.clipboard.writeText(text).then(() => {
            // Dar feedback visual
            element.classList.add('pulse');
            setTimeout(() => {
                element.classList.remove('pulse');
            }, 500);
            
            // Mostrar notificação
            alert('Valor copiado para a área de transferência!');
        }).catch(err => {
            console.error('Erro ao copiar: ', err);
        });
    }
    
    // Função para copiar resultado com unidade dinâmica
    function copyResultWithUnit(valueId, unitId) {
        const valueElement = document.getElementById(valueId);
        const unitElement = document.getElementById(unitId);
        const text = valueElement.textContent + ' ' + unitElement.textContent;
        
        navigator.clipboard.writeText(text).then(() => {
            // Dar feedback visual
            valueElement.classList.add('pulse');
            setTimeout(() => {
                valueElement.classList.remove('pulse');
            }, 500);
            
            // Mostrar notificação
            alert('Valor copiado para a área de transferência!');
        }).catch(err => {
            console.error('Erro ao copiar: ', err);
        });
    }
    
    // Função para resetar calculadora
    function resetCalculator(formId, resultBoxId) {
        // Resetar o formulário
        document.getElementById(formId).reset();
        
        // Esconder o resultado
        document.getElementById(resultBoxId).style.display = 'none';
        
        // Esconder mensagens de erro
        const errorElements = document.querySelectorAll(`#${formId} .error-message`);
        errorElements.forEach(el => {
            el.style.display = 'none';
        });
    }
    
    // Atualizar as opções de destino com base na unidade de origem
    function updateConversionDestinations() {
        const grupo = document.getElementById('unidade_origem').value;
        const destinoSelect = document.getElementById('unidade_destino');
        
        // Limpar opções atuais
        destinoSelect.innerHTML = '';
        
        // Se não selecionou um grupo válido, desabilitar
        if (grupo === 'grupo') {
            destinoSelect.disabled = true;
            destinoSelect.innerHTML = '<option value="">Selecione a unidade de origem primeiro</option>';
            return;
        }
        
        // Habilitar o select
        destinoSelect.disabled = false;
        
        // Adicionar opções baseadas no grupo
        let options = [];
        
        switch(grupo) {
            case 'volume':
                options = [
                    { value: 'mL', text: 'Mililitros (mL)' },
                    { value: 'L', text: 'Litros (L)' },
                    { value: 'm3', text: 'Metros cúbicos (m³)' },
                    { value: 'gal', text: 'Galões (gal)' }
                ];
                break;
            case 'massa':
                options = [
                    { value: 'mg', text: 'Miligramas (mg)' },
                    { value: 'g', text: 'Gramas (g)' },
                    { value: 'kg', text: 'Quilogramas (kg)' },
                    { value: 'ton', text: 'Toneladas (ton)' }
                ];
                break;
            case 'temperatura':
                options = [
                    { value: 'C', text: 'Celsius (°C)' },
                    { value: 'F', text: 'Fahrenheit (°F)' },
                    { value: 'K', text: 'Kelvin (K)' }
                ];
                break;
            case 'concentracao':
                options = [
                    { value: 'ppm', text: 'Partes por milhão (ppm)' },
                    { value: 'ppb', text: 'Partes por bilhão (ppb)' },
                    { value: 'mgL', text: 'Miligramas por litro (mg/L)' },
                    { value: 'gL', text: 'Gramas por litro (g/L)' },
                    { value: 'perc', text: 'Porcentagem (%)' }
                ];
                break;
        }
        
        // Adicionar as opções ao select
        options.forEach(opt => {
            const option = document.createElement('option');
            option.value = opt.value;
            option.textContent = opt.text;
            destinoSelect.appendChild(option);
        });
    }
    
    // Função para enviar solicitação de cálculo
    function calculate(calculationType) {
        // Mapear tipo de cálculo para ID do formulário
        const formMappings = {
            'producao_200': 'form-producao200',
            'producao_litro': 'form-producaoLitro',
            'abaixar_brix': 'form-abaixarBrix',
            'ratio': 'form-ratio',
            'diluicao': 'form-diluicao',
            'conversao': 'form-conversao'
        };
        
        const formId = formMappings[calculationType];
        
        // Validar formulário primeiro
        if (!validateForm(formId)) {
            return;
        }
        
        // Obter os dados conforme o tipo de cálculo
        let data = {
            tipo_calculo: calculationType
        };
        
        switch (calculationType) {
            case 'producao_200':
                data.peso_bruto = parseFloat(document.getElementById('peso_bruto_200').value);
                data.tara = parseFloat(document.getElementById('tara_200').value);
                break;
            case 'producao_litro':
                data.peso = parseFloat(document.getElementById('peso_total').value);
                data.densidade = parseFloat(document.getElementById('densidade').value);
                break;
            case 'abaixar_brix':
                data.brix_atual = parseFloat(document.getElementById('brix_atual').value);
                data.brix_desejado = parseFloat(document.getElementById('brix_desejado').value);
                data.volume_inicial = parseFloat(document.getElementById('volume_inicial').value);
                break;
            case 'ratio':
                data.brix = parseFloat(document.getElementById('brix_ratio').value);
                data.acidez = parseFloat(document.getElementById('acidez_ratio').value);
                break;
            case 'diluicao':
                data.conc_inicial = parseFloat(document.getElementById('conc_inicial').value);
                data.vol_inicial = parseFloat(document.getElementById('vol_inicial').value);
                data.vol_final = parseFloat(document.getElementById('vol_final').value);
                data.unidade = document.getElementById('unidade_conc').value;
                break;
            case 'conversao':
                data.valor = parseFloat(document.getElementById('valor_converter').value);
                data.de = document.getElementById('unidade_origem').value;
                data.para = document.getElementById('unidade_destino').value;
                break;
        }
        
        // Enviar a solicitação para o servidor
        fetch('/calculos/api/calculate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert('Erro: ' + data.error);
                return;
            }
            
            // Mostrar resultado
            const resultBox = document.getElementById(`result-${calculationType}`);
            resultBox.style.display = 'block';
            
            const resultValueElement = document.getElementById(`result-value-${calculationType}`);
            resultValueElement.textContent = formatResult(data.resultado);
            
            // Atualizar unidade se aplicável
            if (calculationType === 'diluicao') {
                document.getElementById('result-unit-diluicao').textContent = 
                    document.getElementById('unidade_conc').value;
            } else if (calculationType === 'conversao') {
                document.getElementById('result-unit-conversao').textContent = 
                    document.getElementById('unidade_destino').options[
                        document.getElementById('unidade_destino').selectedIndex
                    ].text.match(/\(([^)]+)\)/)[1];
            }
            
            // Animar resultado
            resultValueElement.classList.add('pulse');
            setTimeout(() => {
                resultValueElement.classList.remove('pulse');
            }, 500);
        })
        .catch(error => {
            console.error('Erro:', error);
            alert('Ocorreu um erro ao processar o cálculo. Por favor, tente novamente.');
        });
    }
    
    // Inicializar primeira calculadora aberta ao carregar
    document.addEventListener('DOMContentLoaded', function() {
        toggleCalculator('producao200');
    });
</script>
{% endblock %}