{% extends "base.html" %}

{% block title %}Cálculos Técnicos | ZeloPack{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/calculos.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='vendor/bootstrap-icons.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='vendor/animate.min.css') }}">
<script src="{{ url_for('static', filename='vendor/chart.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/calculos.js') }}"></script>
{% endblock %}

{% block content %}
<div class="calculos-app">
    <!-- Barra lateral para navegação de calculadoras -->
    <aside class="calculos-sidebar">
        <div class="sidebar-header">
            <div class="sidebar-brand">
                <i class="bi bi-calculator-fill"></i>
                <span>ZeloCalc</span>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="bi bi-chevron-left"></i>
            </button>
        </div>

        <!-- Buscador de calculadoras -->
        <div class="sidebar-search">
            <div class="search-container">
                <i class="bi bi-search"></i>
                <input type="text" id="calculatorSearch" placeholder="Buscar cálculos..." />
                <button id="clearSearch" class="search-clear"><i class="bi bi-x"></i></button>
            </div>
            <div id="searchResults" class="search-results"></div>
        </div>

        <!-- Navegação por categorias -->
        <nav class="sidebar-nav">
            <div class="nav-section">
                <h6 class="nav-section-title">PRINCIPAIS</h6>
                <ul class="nav-items">
                    <li class="nav-item active" data-calc="finalizar-tanque">
                        <i class="bi bi-droplet-fill"></i>
                        <span>Finalização de Tanque</span>
                        <span class="nav-indicator"><i class="bi bi-star-fill"></i></span>
                    </li>
                    <li class="nav-item" data-calc="brix-padrao">
                        <i class="bi bi-thermometer-half"></i>
                        <span>Brix Padrão</span>
                        <span class="nav-indicator"><i class="bi bi-star-fill"></i></span>
                    </li>
                    <li class="nav-item" data-calc="peso-liquido">
                        <i class="bi bi-box-seam"></i>
                        <span>Peso Líquido</span>
                    </li>
                </ul>
            </div>

            <div class="nav-section">
                <h6 class="nav-section-title">CATEGORIAS</h6>
                <ul class="nav-items">
                    <li class="nav-item" data-category="tanques">
                        <i class="bi bi-moisture"></i>
                        <span>Tanques</span>
                        <span class="nav-count">6</span>
                    </li>
                    <li class="nav-item" data-category="producao">
                        <i class="bi bi-gear-wide-connected"></i>
                        <span>Produção</span>
                        <span class="nav-count">10</span>
                    </li>
                    <li class="nav-item" data-category="laboratorio">
                        <i class="bi bi-eyedropper"></i>
                        <span>Laboratório</span>
                        <span class="nav-count">8</span>
                    </li>
                    <li class="nav-item" data-category="conversoes">
                        <i class="bi bi-arrow-left-right"></i>
                        <span>Conversões</span>
                        <span class="nav-count">4</span>
                    </li>
                    <li class="nav-item" data-category="sucos">
                        <i class="bi bi-cup-straw"></i>
                        <span>Sucos</span>
                        <span class="nav-count">8</span>
                    </li>
                </ul>
            </div>

            <div class="nav-section">
                <h6 class="nav-section-title">RECENTES</h6>
                <ul class="nav-items">
                    <li class="nav-item" data-calc="diluicao">
                        <i class="bi bi-water"></i>
                        <span>Diluição</span>
                        <span class="nav-time">12m</span>
                    </li>
                    <li class="nav-item" data-calc="rendimento">
                        <i class="bi bi-graph-up-arrow"></i>
                        <span>Rendimento</span>
                        <span class="nav-time">1h</span>
                    </li>
                </ul>
            </div>
        </nav>
    </aside>

    <!-- Área principal do conteúdo -->
    <main class="calculos-main">
        <!-- Barra de navegação superior -->
        <header class="main-header">
            <h1 class="page-title">Cálculos Técnicos</h1>
            <div class="header-actions">
                <button class="theme-toggle" id="themeToggle">
                    <i class="bi bi-sun"></i>
                </button>
                <button class="help-toggle" id="helpToggle">
                    <i class="bi bi-question-circle"></i>
                </button>
            </div>
        </header>

        <!-- Conteúdo do cálculo atual -->
        <div class="calculation-content">
            <!-- Interface da calculadora atual -->
            <div class="calculation-container active" id="finalizar-tanque">
                <div class="calculation-header">
                    <div class="calc-title-container">
                        <i class="bi bi-droplet-fill"></i>
                        <div class="calc-title-text">
                            <h2>Finalização de Tanque</h2>
                            <span class="calc-category">Tanques</span>
                        </div>
                    </div>
                    <div class="calculation-actions">
                        <button class="btn-icon" title="Favoritar">
                            <i class="bi bi-star"></i>
                        </button>
                        <button class="btn-icon" title="Expandir">
                            <i class="bi bi-arrows-fullscreen"></i>
                        </button>
                    </div>
                </div>

                <div class="calculation-description">
                    <p>Calcula a quantidade de água necessária para diluir o concentrado e finalizar um tanque com Brix específico, mantendo as propriedades do produto dentro dos parâmetros desejados.</p>
                </div>

                <div class="calculation-steps">
                    <div class="step-indicator">
                        <div class="step active" data-step="1">
                            <div class="step-number">1</div>
                            <div class="step-label">Valores</div>
                        </div>
                        <div class="step-line"></div>
                        <div class="step" data-step="2">
                            <div class="step-number">2</div>
                            <div class="step-label">Cálculo</div>
                        </div>
                        <div class="step-line"></div>
                        <div class="step" data-step="3">
                            <div class="step-number">3</div>
                            <div class="step-label">Resultado</div>
                        </div>
                    </div>

                    <div class="calculation-panels">
                        <!-- Painel 1: Entrada de dados -->
                        <div class="calculation-panel active" id="panel-1">
                            <div class="calculation-form">
                                <div class="form-header">
                                    <h3>Parâmetros do Tanque</h3>
                                    <p>Informe os dados do concentrado e do Brix desejado</p>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="volume_concentrado">Volume do Concentrado</label>
                                        <div class="input-with-unit">
                                            <input type="number" id="volume_concentrado" class="form-input" placeholder="0" min="0" step="0.1">
                                            <div class="unit-selector">
                                                <span class="unit active">L</span>
                                            </div>
                                        </div>
                                        <span class="form-hint">Volume inicial do concentrado no tanque</span>
                                    </div>

                                    <div class="form-group">
                                        <label for="brix_concentrado">Brix do Concentrado</label>
                                        <div class="input-with-unit">
                                            <input type="number" id="brix_concentrado" class="form-input" placeholder="0" min="0" step="0.1">
                                            <div class="unit-selector">
                                                <span class="unit active">°Bx</span>
                                            </div>
                                        </div>
                                        <span class="form-hint">Concentração inicial do tanque</span>
                                    </div>

                                    <div class="form-group">
                                        <label for="brix_desejado">Brix Desejado</label>
                                        <div class="input-with-unit">
                                            <input type="number" id="brix_desejado" class="form-input" placeholder="0" min="0" step="0.1">
                                            <div class="unit-selector">
                                                <span class="unit active">°Bx</span>
                                            </div>
                                        </div>
                                        <span class="form-hint">Concentração final desejada</span>
                                    </div>
                                </div>

                                <div class="form-actions">
                                    <button class="btn-secondary" id="btn-reset">
                                        <i class="bi bi-arrow-counterclockwise"></i> Limpar
                                    </button>
                                    <button class="btn-primary" id="btn-calculate">
                                        <i class="bi bi-calculator"></i> Calcular
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Painel 2: Cálculo e fórmula -->
                        <div class="calculation-panel" id="panel-2">
                            <div class="formula-display">
                                <div class="form-header">
                                    <h3>Fórmula Aplicada</h3>
                                    <p>Visualize como o cálculo é realizado</p>
                                </div>

                                <div class="formula-container">
                                    <h4>Volume de Água Necessária</h4>
                                    <div class="formula">
                                        <span class="formula-math">Água (L) = Volume Concentrado × ((Brix Concentrado ÷ Brix Desejado) - 1)</span>
                                    </div>
                                    
                                    <div class="formula-explanation">
                                        <p>Esta fórmula calcula a quantidade exata de água a ser adicionada para diluir o concentrado até o Brix desejado. O resultado garante a manutenção precisa das características sensoriais e de composição do produto.</p>
                                    </div>
                                    
                                    <div class="calculation-values">
                                        <h5>Valores Utilizados</h5>
                                        <ul>
                                            <li><strong>Volume do Concentrado:</strong> <span id="calc-volume-concentrado">0</span> L</li>
                                            <li><strong>Brix do Concentrado:</strong> <span id="calc-brix-concentrado">0</span> °Bx</li>
                                            <li><strong>Brix Desejado:</strong> <span id="calc-brix-desejado">0</span> °Bx</li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="calculation-figure">
                                    <img src="https://i.imgur.com/4Y1Fv1s.png" alt="Ilustração de diluição em tanque" class="figure-image">
                                    <div class="figure-caption">Representação visual do processo de diluição</div>
                                </div>
                                
                                <div class="form-actions">
                                    <button class="btn-outline" id="btn-back-to-input">
                                        <i class="bi bi-arrow-left"></i> Voltar
                                    </button>
                                    <button class="btn-primary" id="btn-show-result">
                                        <i class="bi bi-arrow-right"></i> Ver Resultado
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Painel 3: Resultados -->
                        <div class="calculation-panel" id="panel-3">
                            <div class="result-display">
                                <div class="form-header">
                                    <h3>Resultado do Cálculo</h3>
                                    <p>Valores calculados para finalização do tanque</p>
                                </div>

                                <div class="result-cards">
                                    <div class="result-card primary">
                                        <div class="result-icon">
                                            <i class="bi bi-droplet-half"></i>
                                        </div>
                                        <div class="result-details">
                                            <h4>Água Necessária</h4>
                                            <div class="result-value" id="result-agua">0</div>
                                            <div class="result-unit">litros</div>
                                        </div>
                                    </div>
                                    
                                    <div class="result-card secondary">
                                        <div class="result-icon">
                                            <i class="bi bi-moisture"></i>
                                        </div>
                                        <div class="result-details">
                                            <h4>Volume Final</h4>
                                            <div class="result-value" id="result-volume-final">0</div>
                                            <div class="result-unit">litros</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="result-chart">
                                    <h4>Composição Final do Tanque</h4>
                                    <div class="chart-container">
                                        <canvas id="tanqueChart" width="400" height="200"></canvas>
                                    </div>
                                </div>

                                <div class="result-tips">
                                    <h5><i class="bi bi-lightbulb"></i> Dicas de Operação</h5>
                                    <ul>
                                        <li>Adicione a água lentamente enquanto mantém o sistema de agitação ligado</li>
                                        <li>Meça o Brix após a adição para confirmar se o valor desejado foi atingido</li>
                                        <li>Temperatura ideal para medição: 20°C</li>
                                    </ul>
                                </div>

                                <div class="form-actions">
                                    <button class="btn-outline" id="btn-back-to-formula">
                                        <i class="bi bi-arrow-left"></i> Voltar
                                    </button>
                                    <button class="btn-outline" id="btn-new-calculation">
                                        <i class="bi bi-plus-circle"></i> Novo Cálculo
                                    </button>
                                    <button class="btn-primary" id="btn-save-result">
                                        <i class="bi bi-download"></i> Salvar Resultado
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Interface de boas-vindas quando nenhum cálculo está selecionado -->
            <div class="welcome-container" id="welcome-screen" style="display: none;">
                <div class="welcome-content">
                    <div class="welcome-icon">
                        <i class="bi bi-calculator"></i>
                    </div>
                    <h2>Bem-vindo à Central de Cálculos</h2>
                    <p>Selecione um cálculo na barra lateral ou use a pesquisa para encontrar rapidamente o que precisa.</p>
                    <div class="welcome-actions">
                        <button class="btn-primary">
                            <i class="bi bi-star-fill"></i> Cálculos Populares
                        </button>
                        <button class="btn-outline">
                            <i class="bi bi-grid-3x3-gap"></i> Ver Todos
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Ajuda flutuante -->
    <div class="help-overlay" id="helpOverlay">
        <div class="help-dialog">
            <div class="help-header">
                <h3>Ajuda Rápida</h3>
                <button class="help-close" id="helpClose">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="help-content">
                <h4>Sobre os Cálculos Técnicos</h4>
                <p>Este módulo contém todas as 36 calculadoras utilizadas para análises e controle de qualidade na ZeloPack. Cada calculadora foi desenvolvida especificamente para os processos da empresa.</p>
                
                <h4>Como usar:</h4>
                <ol>
                    <li>Selecione uma calculadora na barra lateral</li>
                    <li>Preencha os campos solicitados com os dados do seu processo</li>
                    <li>Clique em "Calcular" para obter o resultado</li>
                    <li>Analise o resultado e utilize as opções de exportação se necessário</li>
                </ol>
                
                <h4>Recursos disponíveis:</h4>
                <ul>
                    <li>36 calculadoras técnicas específicas</li>
                    <li>Fórmulas detalhadas com explicações</li>
                    <li>Gráficos interativos para visualização de dados</li>
                    <li>Exportação de resultados</li>
                    <li>Histórico de cálculos recentes</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
                
                <!-- Conteúdo das abas -->
                <div class="tab-content" id="calculationTabsContent">
                
                <!-- Aba de Produção -->
                <div class="tab-pane fade show active" id="producao" role="tabpanel" aria-labelledby="producao-tab">
                    <div class="calculation-visual">
                        <div class="calculation-icon">
                            <i class="bi bi-gear-wide-connected"></i>
                        </div>
                        <div class="calculation-details">
                            <h3>Cálculos de Produção</h3>
                            <p>Ferramentas essenciais para controle e monitoramento do processo produtivo. Realize cálculos de peso líquido, volume de produção e muito mais.</p>
                        </div>
                    </div>
                    
                    <!-- Sub navegação por categorias -->
                    <div class="sub-tabs">
                        <ul class="nav nav-pills" id="subTabsProducao" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="peso-tab" data-bs-toggle="pill" data-bs-target="#peso-content" type="button" role="tab">
                                    <i class="bi bi-speedometer2"></i> Peso e Volume
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="rendimento-tab" data-bs-toggle="pill" data-bs-target="#rendimento-content" type="button" role="tab">
                                    <i class="bi bi-bar-chart-line"></i> Rendimento
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="controle-tab" data-bs-toggle="pill" data-bs-target="#controle-content" type="button" role="tab">
                                    <i class="bi bi-clipboard-check"></i> Controle
                                </button>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="tab-content">
                        <!-- Conteúdo Peso e Volume -->
                        <div class="tab-pane fade show active" id="peso-content" role="tabpanel">
                            <div class="row">
                                <!-- Calculadora 1: Produção 200g -->
                        <div class="col-md-6">
                            <div class="card card-calculator">
                                <div class="card-header-calculator">
                                    <i class="fas fa-balance-scale me-2"></i> Produção 200g
                                </div>
                                <div class="card-body-calculator">
                                    <div class="calculation-description">
                                        Determina o peso líquido de embalagens de 200g, subtraindo a tara (peso da embalagem) do peso bruto.
                                    </div>
                                    <div class="formula-box">
                                        <strong>Fórmula:</strong> Peso Líquido = Peso Bruto - Tara
                                    </div>
                                    <form id="form-producao200">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="form-label" for="peso_bruto_200">Peso Bruto (g):</label>
                                                    <input type="number" class="form-control" id="peso_bruto_200" placeholder="Digite o peso bruto" step="0.01" required>
                                                    <div class="error-message" id="error-peso_bruto_200">Valor inválido</div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="form-label" for="tara_200">Tara (g):</label>
                                                    <input type="number" class="form-control" id="tara_200" placeholder="Digite a tara" step="0.01" required>
                                                    <div class="error-message" id="error-tara_200">Valor inválido</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-center mt-3">
                                            <button type="button" class="btn btn-calculate" onclick="calculate('producao_200')">
                                                <i class="fas fa-calculator"></i> Calcular
                                            </button>
                                        </div>
                                        <div class="result-box" id="result-producao_200">
                                            <div class="row">
                                                <div class="col-md-12 text-center">
                                                    <div class="result-label">Peso Líquido:</div>
                                                    <div class="result-value" id="result-value-producao_200">0</div>
                                                    <div class="result-unit">gramas</div>
                                                </div>
                                            </div>
                                            <div class="action-buttons">
                                                <div class="action-button copy" onclick="copyResult('result-value-producao_200', 'g')">
                                                    <i class="fas fa-copy"></i> Copiar
                                                </div>
                                                <div class="action-button reset" onclick="resetCalculator('form-producao200', 'result-producao_200')">
                                                    <i class="fas fa-redo"></i> Limpar
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Calculadora 2: Volume de Produção -->
                        <div class="col-md-6">
                            <div class="card card-calculator">
                                <div class="card-header-calculator">
                                    <i class="fas fa-tint me-2"></i> Volume de Produção
                                </div>
                                <div class="card-body-calculator">
                                    <div class="calculation-description">
                                        Calcula o volume final de produção com base no peso e densidade do produto.
                                    </div>
                                    <div class="formula-box">
                                        <strong>Fórmula:</strong> Volume (L) = Massa (kg) / Densidade (kg/L)
                                    </div>
                                    <form id="form-producaoLitro">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="form-label" for="peso_total">Peso Total (kg):</label>
                                                    <input type="number" class="form-control" id="peso_total" placeholder="Digite o peso total" step="0.01" required>
                                                    <div class="error-message" id="error-peso_total">Valor inválido</div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="form-label" for="densidade">Densidade (kg/L):</label>
                                                    <input type="number" class="form-control" id="densidade" placeholder="Digite a densidade" step="0.001" required>
                                                    <div class="error-message" id="error-densidade">Valor inválido</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-center mt-3">
                                            <button type="button" class="btn btn-calculate" onclick="calculate('producao_litro')">
                                                <i class="fas fa-calculator"></i> Calcular
                                            </button>
                                        </div>
                                        <div class="result-box" id="result-producao_litro">
                                            <div class="row">
                                                <div class="col-md-12 text-center">
                                                    <div class="result-label">Volume Produzido:</div>
                                                    <div class="result-value" id="result-value-producao_litro">0</div>
                                                    <div class="result-unit">litros</div>
                                                </div>
                                            </div>
                                            <div class="action-buttons">
                                                <div class="action-button copy" onclick="copyResult('result-value-producao_litro', 'L')">
                                                    <i class="fas fa-copy"></i> Copiar
                                                </div>
                                                <div class="action-button reset" onclick="resetCalculator('form-producaoLitro', 'result-producao_litro')">
                                                    <i class="fas fa-redo"></i> Limpar
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Calculadora 3: Rendimento de Produção -->
                        <div class="col-md-6">
                            <div class="card card-calculator mt-4">
                                <div class="card-header-calculator">
                                    <i class="fas fa-percentage me-2"></i> Rendimento de Produção
                                </div>
                                <div class="card-body-calculator">
                                    <div class="calculation-description">
                                        Calcula o rendimento percentual da produção com base na entrada e saída de material.
                                    </div>
                                    <div class="formula-box">
                                        <strong>Fórmula:</strong> Rendimento (%) = (Saída / Entrada) × 100
                                    </div>
                                    <form id="form-rendimento">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="form-label" for="entrada_material">Material de Entrada (kg):</label>
                                                    <input type="number" class="form-control" id="entrada_material" placeholder="Digite a entrada" step="0.01" required>
                                                    <div class="error-message" id="error-entrada_material">Valor inválido</div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="form-label" for="saida_material">Material de Saída (kg):</label>
                                                    <input type="number" class="form-control" id="saida_material" placeholder="Digite a saída" step="0.01" required>
                                                    <div class="error-message" id="error-saida_material">Valor inválido</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-center mt-3">
                                            <button type="button" class="btn btn-calculate" onclick="calculate('rendimento')">
                                                <i class="fas fa-calculator"></i> Calcular
                                            </button>
                                        </div>
                                        <div class="result-box" id="result-rendimento">
                                            <div class="row">
                                                <div class="col-md-12 text-center">
                                                    <div class="result-label">Rendimento:</div>
                                                    <div class="result-value" id="result-value-rendimento">0</div>
                                                    <div class="result-unit">%</div>
                                                </div>
                                            </div>
                                            <div class="action-buttons">
                                                <div class="action-button copy" onclick="copyResult('result-value-rendimento', '%')">
                                                    <i class="fas fa-copy"></i> Copiar
                                                </div>
                                                <div class="action-button reset" onclick="resetCalculator('form-rendimento', 'result-rendimento')">
                                                    <i class="fas fa-redo"></i> Limpar
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Calculadora 4: Consumo de Insumos -->
                        <div class="col-md-6">
                            <div class="card card-calculator mt-4">
                                <div class="card-header-calculator">
                                    <i class="fas fa-boxes me-2"></i> Consumo de Insumos
                                </div>
                                <div class="card-body-calculator">
                                    <div class="calculation-description">
                                        Calcula o consumo de insumos por unidade de produto final.
                                    </div>
                                    <div class="formula-box">
                                        <strong>Fórmula:</strong> Consumo por Unidade = Quantidade Total de Insumo / Número de Unidades Produzidas
                                    </div>
                                    <form id="form-consumo">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="form-label" for="quantidade_insumo">Quantidade de Insumo (kg):</label>
                                                    <input type="number" class="form-control" id="quantidade_insumo" placeholder="Digite a quantidade" step="0.01" required>
                                                    <div class="error-message" id="error-quantidade_insumo">Valor inválido</div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="form-label" for="unidades_produzidas">Unidades Produzidas:</label>
                                                    <input type="number" class="form-control" id="unidades_produzidas" placeholder="Digite as unidades" step="1" required>
                                                    <div class="error-message" id="error-unidades_produzidas">Valor inválido</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-center mt-3">
                                            <button type="button" class="btn btn-calculate" onclick="calculate('consumo')">
                                                <i class="fas fa-calculator"></i> Calcular
                                            </button>
                                        </div>
                                        <div class="result-box" id="result-consumo">
                                            <div class="row">
                                                <div class="col-md-12 text-center">
                                                    <div class="result-label">Consumo por Unidade:</div>
                                                    <div class="result-value" id="result-value-consumo">0</div>
                                                    <div class="result-unit">kg/unidade</div>
                                                </div>
                                            </div>
                                            <div class="action-buttons">
                                                <div class="action-button copy" onclick="copyResult('result-value-consumo', 'kg/unidade')">
                                                    <i class="fas fa-copy"></i> Copiar
                                                </div>
                                                <div class="action-button reset" onclick="resetCalculator('form-consumo', 'result-consumo')">
                                                    <i class="fas fa-redo"></i> Limpar
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Aba de Laboratório -->
                <div class="tab-pane fade" id="laboratorio" role="tabpanel" aria-labelledby="laboratorio-tab">
                    <div class="calculation-visual">
                        <div class="calculation-icon">
                            <i class="fas fa-flask"></i>
                        </div>
                        <div class="calculation-details">
                            <h3>Cálculos de Laboratório</h3>
                            <p>Ferramentas para análises de laboratório, incluindo diluições, concentrações e cálculos relacionados às propriedades físico-químicas.</p>
                        </div>
                    </div>
                    
                    <div class="row">
                        <!-- Calculadora 1: Diluição para Ajuste de Brix -->
                        <div class="col-md-6">
                            <div class="card card-calculator">
                                <div class="card-header-calculator">
                                    <i class="fas fa-arrow-down me-2"></i> Diluição para Ajuste de Brix
                                </div>
                                <div class="card-body-calculator">
                                    <div class="calculation-description">
                                        Estima quanto de água é necessário adicionar para reduzir o Brix de uma solução até o valor desejado.
                                    </div>
                                    <div class="formula-box">
                                        <strong>Fórmula:</strong> Volume de água (L) = (Volume inicial × Brix atual / Brix desejado) - Volume inicial
                                    </div>
                                    <form id="form-abaixarBrix">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="form-label" for="brix_atual">Brix Atual:</label>
                                                    <input type="number" class="form-control" id="brix_atual" placeholder="Digite o Brix atual" step="0.1" required>
                                                    <div class="error-message" id="error-brix_atual">Valor inválido</div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="form-label" for="brix_desejado">Brix Desejado:</label>
                                                    <input type="number" class="form-control" id="brix_desejado" placeholder="Digite o Brix desejado" step="0.1" required>
                                                    <div class="error-message" id="error-brix_desejado">Valor inválido</div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="form-label" for="volume_inicial">Volume Inicial (L):</label>
                                                    <input type="number" class="form-control" id="volume_inicial" placeholder="Digite o volume inicial" step="0.1" required>
                                                    <div class="error-message" id="error-volume_inicial">Valor inválido</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-center mt-3">
                                            <button type="button" class="btn btn-calculate" onclick="calculate('abaixar_brix')">
                                                <i class="fas fa-calculator"></i> Calcular
                                            </button>
                                        </div>
                                        <div class="result-box" id="result-abaixar_brix">
                                            <div class="row">
                                                <div class="col-md-12 text-center">
                                                    <div class="result-label">Água a Adicionar:</div>
                                                    <div class="result-value" id="result-value-abaixar_brix">0</div>
                                                    <div class="result-unit">litros</div>
                                                </div>
                                            </div>
                                            <div class="action-buttons">
                                                <div class="action-button copy" onclick="copyResult('result-value-abaixar_brix', 'L')">
                                                    <i class="fas fa-copy"></i> Copiar
                                                </div>
                                                <div class="action-button reset" onclick="resetCalculator('form-abaixarBrix', 'result-abaixar_brix')">
                                                    <i class="fas fa-redo"></i> Limpar
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Calculadora 2: Ratio (Brix/Acidez) -->
                        <div class="col-md-6">
                            <div class="card card-calculator">
                                <div class="card-header-calculator">
                                    <i class="fas fa-divide me-2"></i> Ratio (Brix/Acidez)
                                </div>
                                <div class="card-body-calculator">
                                    <div class="calculation-description">
                                        Relação entre Brix e Acidez, importante para controle de qualidade do suco. O Ratio é um indicador importante do sabor e ponto de colheita para frutas.
                                    </div>
                                    <div class="formula-box">
                                        <strong>Fórmula:</strong> Ratio = Brix / Acidez
                                    </div>
                                    <form id="form-ratio">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="form-label" for="brix_ratio">Brix:</label>
                                                    <input type="number" class="form-control" id="brix_ratio" placeholder="Digite o Brix" step="0.1" required>
                                                    <div class="error-message" id="error-brix_ratio">Valor inválido</div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="form-label" for="acidez_ratio">Acidez:</label>
                                                    <input type="number" class="form-control" id="acidez_ratio" placeholder="Digite a acidez" step="0.01" required>
                                                    <div class="error-message" id="error-acidez_ratio">Valor inválido</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-center mt-3">
                                            <button type="button" class="btn btn-calculate" onclick="calculate('ratio')">
                                                <i class="fas fa-calculator"></i> Calcular
                                            </button>
                                        </div>
                                        <div class="result-box" id="result-ratio">
                                            <div class="row">
                                                <div class="col-md-12 text-center">
                                                    <div class="result-label">Ratio:</div>
                                                    <div class="result-value" id="result-value-ratio">0</div>
                                                </div>
                                            </div>
                                            <div class="action-buttons">
                                                <div class="action-button copy" onclick="copyResult('result-value-ratio', '')">
                                                    <i class="fas fa-copy"></i> Copiar
                                                </div>
                                                <div class="action-button reset" onclick="resetCalculator('form-ratio', 'result-ratio')">
                                                    <i class="fas fa-redo"></i> Limpar
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Calculadora 3: Diluição de Solução -->
                        <div class="col-md-6">
                            <div class="card card-calculator mt-4">
                                <div class="card-header-calculator">
                                    <i class="fas fa-vial me-2"></i> Diluição de Solução
                                </div>
                                <div class="card-body-calculator">
                                    <div class="calculation-description">
                                        Calcula a concentração final de uma solução após diluição.
                                    </div>
                                    <div class="formula-box">
                                        <strong>Fórmula:</strong> C₁ × V₁ = C₂ × V₂ (onde C = concentração, V = volume)
                                    </div>
                                    <form id="form-diluicao">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label class="form-label" for="conc_inicial">Concentração inicial:</label>
                                                    <input type="number" class="form-control" id="conc_inicial" placeholder="Conc. inicial" step="0.01" required>
                                                    <div class="error-message" id="error-conc_inicial">Valor inválido</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label class="form-label" for="vol_inicial">Volume inicial (mL):</label>
                                                    <input type="number" class="form-control" id="vol_inicial" placeholder="Vol. inicial" step="0.1" required>
                                                    <div class="error-message" id="error-vol_inicial">Valor inválido</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label class="form-label" for="vol_final">Volume final (mL):</label>
                                                    <input type="number" class="form-control" id="vol_final" placeholder="Vol. final" step="0.1" required>
                                                    <div class="error-message" id="error-vol_final">Valor inválido</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label class="form-label" for="unidade_conc">Unidade:</label>
                                                    <select class="form-control" id="unidade_conc">
                                                        <option value="%">Porcentagem (%)</option>
                                                        <option value="mg/L">mg/L</option>
                                                        <option value="g/L">g/L</option>
                                                        <option value="mol/L">mol/L</option>
                                                        <option value="ppm">ppm</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-center mt-3">
                                            <button type="button" class="btn btn-calculate" onclick="calculate('diluicao')">
                                                <i class="fas fa-calculator"></i> Calcular
                                            </button>
                                        </div>
                                        <div class="result-box" id="result-diluicao">
                                            <div class="row">
                                                <div class="col-md-12 text-center">
                                                    <div class="result-label">Concentração final:</div>
                                                    <div class="result-value" id="result-value-diluicao">0</div>
                                                    <div class="result-unit" id="result-unit-diluicao">%</div>
                                                </div>
                                            </div>
                                            <div class="action-buttons">
                                                <div class="action-button copy" onclick="copyResultWithUnit('result-value-diluicao', 'result-unit-diluicao')">
                                                    <i class="fas fa-copy"></i> Copiar
                                                </div>
                                                <div class="action-button reset" onclick="resetCalculator('form-diluicao', 'result-diluicao')">
                                                    <i class="fas fa-redo"></i> Limpar
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Calculadora 4: Concentração de Soluções -->
                        <div class="col-md-6">
                            <div class="card card-calculator mt-4">
                                <div class="card-header-calculator">
                                    <i class="fas fa-fill-drip me-2"></i> Preparo de Soluções
                                </div>
                                <div class="card-body-calculator">
                                    <div class="calculation-description">
                                        Calcula a quantidade de soluto necessária para preparar uma solução com concentração específica.
                                    </div>
                                    <div class="formula-box">
                                        <strong>Fórmula:</strong> Massa do soluto = Concentração × Volume
                                    </div>
                                    <form id="form-solucao">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="form-label" for="concentracao_desejada">Concentração (%):</label>
                                                    <input type="number" class="form-control" id="concentracao_desejada" placeholder="Digite a concentração" step="0.01" required>
                                                    <div class="error-message" id="error-concentracao_desejada">Valor inválido</div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="form-label" for="volume_solucao">Volume da solução (mL):</label>
                                                    <input type="number" class="form-control" id="volume_solucao" placeholder="Digite o volume" step="0.1" required>
                                                    <div class="error-message" id="error-volume_solucao">Valor inválido</div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="form-label" for="tipo_solucao">Tipo de solução:</label>
                                                    <select class="form-control" id="tipo_solucao">
                                                        <option value="massa">Massa/Volume (m/v)</option>
                                                        <option value="volume">Volume/Volume (v/v)</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-center mt-3">
                                            <button type="button" class="btn btn-calculate" onclick="calculate('solucao')">
                                                <i class="fas fa-calculator"></i> Calcular
                                            </button>
                                        </div>
                                        <div class="result-box" id="result-solucao">
                                            <div class="row">
                                                <div class="col-md-12 text-center">
                                                    <div class="result-label">Quantidade de soluto:</div>
                                                    <div class="result-value" id="result-value-solucao">0</div>
                                                    <div class="result-unit" id="result-unit-solucao">g</div>
                                                </div>
                                            </div>
                                            <div class="action-buttons">
                                                <div class="action-button copy" onclick="copyResultWithUnit('result-value-solucao', 'result-unit-solucao')">
                                                    <i class="fas fa-copy"></i> Copiar
                                                </div>
                                                <div class="action-button reset" onclick="resetCalculator('form-solucao', 'result-solucao')">
                                                    <i class="fas fa-redo"></i> Limpar
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Aba de Conversões -->
                <div class="tab-pane fade" id="conversoes" role="tabpanel" aria-labelledby="conversoes-tab">
                    <div class="calculation-visual">
                        <div class="calculation-icon">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                        <div class="calculation-details">
                            <h3>Conversões de Unidades</h3>
                            <p>Realize conversões entre diferentes unidades de medida utilizadas em processos industriais e análises de laboratório.</p>
                        </div>
                    </div>
                    
                    <!-- Calculadora de Conversão -->
                    <div class="card card-calculator">
                        <div class="card-header-calculator">
                            <i class="fas fa-exchange-alt me-2"></i> Conversão de Unidades
                        </div>
                        <div class="card-body-calculator">
                            <div class="calculation-description">
                                Converte entre diferentes unidades de medida frequentemente usadas no laboratório.
                            </div>
                            <form id="form-conversao">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="form-label" for="valor_converter">Valor:</label>
                                            <input type="number" class="form-control" id="valor_converter" placeholder="Valor para converter" step="any" required>
                                            <div class="error-message" id="error-valor_converter">Valor inválido</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="form-label" for="unidade_origem">De:</label>
                                            <select class="form-control" id="unidade_origem" onchange="updateConversionDestinations()">
                                                <option value="grupo">Selecione o grupo</option>
                                                <option value="volume">Volume</option>
                                                <option value="massa">Massa</option>
                                                <option value="temperatura">Temperatura</option>
                                                <option value="concentracao">Concentração</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="form-label" for="unidade_destino">Para:</label>
                                            <select class="form-control" id="unidade_destino" disabled>
                                                <option value="">Selecione a unidade de origem primeiro</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="form-label" style="visibility: hidden;">Calcular</label>
                                            <button type="button" class="btn btn-calculate form-control" onclick="calculate('conversao')">
                                                <i class="fas fa-calculator"></i> Converter
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="result-box" id="result-conversao">
                                    <div class="row">
                                        <div class="col-md-12 text-center">
                                            <div class="result-label">Resultado da conversão:</div>
                                            <div class="result-value" id="result-value-conversao">0</div>
                                            <div class="result-unit" id="result-unit-conversao"></div>
                                        </div>
                                    </div>
                                    <div class="action-buttons">
                                        <div class="action-button copy" onclick="copyResultWithUnit('result-value-conversao', 'result-unit-conversao')">
                                            <i class="fas fa-copy"></i> Copiar
                                        </div>
                                        <div class="action-button reset" onclick="resetCalculator('form-conversao', 'result-conversao')">
                                            <i class="fas fa-redo"></i> Limpar
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Tabelas de Conversão -->
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-primary text-white">
                                    <i class="fas fa-table me-2"></i> Tabela de Conversão - Volume
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>De</th>
                                                    <th>Para</th>
                                                    <th>Multiplicar por</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Mililitros (mL)</td>
                                                    <td>Litros (L)</td>
                                                    <td>0.001</td>
                                                </tr>
                                                <tr>
                                                    <td>Litros (L)</td>
                                                    <td>Mililitros (mL)</td>
                                                    <td>1000</td>
                                                </tr>
                                                <tr>
                                                    <td>Litros (L)</td>
                                                    <td>Metros cúbicos (m³)</td>
                                                    <td>0.001</td>
                                                </tr>
                                                <tr>
                                                    <td>Galões (US)</td>
                                                    <td>Litros (L)</td>
                                                    <td>3.78541</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-success text-white">
                                    <i class="fas fa-table me-2"></i> Tabela de Conversão - Massa
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>De</th>
                                                    <th>Para</th>
                                                    <th>Multiplicar por</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Miligramas (mg)</td>
                                                    <td>Gramas (g)</td>
                                                    <td>0.001</td>
                                                </tr>
                                                <tr>
                                                    <td>Gramas (g)</td>
                                                    <td>Quilogramas (kg)</td>
                                                    <td>0.001</td>
                                                </tr>
                                                <tr>
                                                    <td>Quilogramas (kg)</td>
                                                    <td>Gramas (g)</td>
                                                    <td>1000</td>
                                                </tr>
                                                <tr>
                                                    <td>Quilogramas (kg)</td>
                                                    <td>Toneladas (ton)</td>
                                                    <td>0.001</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Aba de Sucos -->
                <div class="tab-pane fade" id="juice" role="tabpanel" aria-labelledby="juice-tab">
                    <div class="calculation-visual">
                        <div class="calculation-icon">
                            <i class="fas fa-tint"></i>
                        </div>
                        <div class="calculation-details">
                            <h3>Cálculos para Sucos</h3>
                            <p>Ferramentas específicas para análise e processamento de sucos, incluindo correção de Brix, acidez e outros parâmetros de qualidade.</p>
                        </div>
                    </div>
                    
                    <!-- Subtabs dentro da aba de Sucos -->
                    <ul class="nav nav-pills mb-3" id="juice-subtabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="juice-quality-tab" data-bs-toggle="pill" data-bs-target="#juice-quality" type="button" role="tab" aria-controls="juice-quality" aria-selected="true">Qualidade</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="juice-processing-tab" data-bs-toggle="pill" data-bs-target="#juice-processing" type="button" role="tab" aria-controls="juice-processing" aria-selected="false">Processamento</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="juice-recipes-tab" data-bs-toggle="pill" data-bs-target="#juice-recipes" type="button" role="tab" aria-controls="juice-recipes" aria-selected="false">Formulações</button>
                        </li>
                    </ul>
                    
                    <div class="tab-content" id="juice-subtabs-content">
                        <!-- Subtab: Qualidade -->
                        <div class="tab-pane fade show active" id="juice-quality" role="tabpanel" aria-labelledby="juice-quality-tab">
                            <div class="row">
                                <!-- Calculadora de Ratio por Fruta -->
                                <div class="col-md-6">
                                    <div class="card card-calculator">
                                        <div class="card-header-calculator">
                                            <i class="fas fa-apple-alt me-2"></i> Ratio por Tipo de Fruta
                                        </div>
                                        <div class="card-body-calculator">
                                            <div class="calculation-description">
                                                Compara o Ratio (Brix/Acidez) medido com valores de referência para diferentes tipos de frutas.
                                            </div>
                                            <form id="form-ratio-fruta">
                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <div class="form-group">
                                                            <label class="form-label" for="tipo_fruta">Tipo de Fruta:</label>
                                                            <select class="form-control" id="tipo_fruta">
                                                                <option value="laranja">Laranja</option>
                                                                <option value="uva">Uva</option>
                                                                <option value="maca">Maçã</option>
                                                                <option value="manga">Manga</option>
                                                                <option value="abacaxi">Abacaxi</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="form-group">
                                                            <label class="form-label" for="brix_fruta">Brix:</label>
                                                            <input type="number" class="form-control" id="brix_fruta" placeholder="Digite o Brix" step="0.1" required>
                                                            <div class="error-message" id="error-brix_fruta">Valor inválido</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="form-group">
                                                            <label class="form-label" for="acidez_fruta">Acidez:</label>
                                                            <input type="number" class="form-control" id="acidez_fruta" placeholder="Digite a acidez" step="0.01" required>
                                                            <div class="error-message" id="error-acidez_fruta">Valor inválido</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="text-center mt-3">
                                                    <button type="button" class="btn btn-calculate" onclick="calculate('ratio_fruta')">
                                                        <i class="fas fa-calculator"></i> Calcular
                                                    </button>
                                                </div>
                                                <div class="result-box" id="result-ratio_fruta">
                                                    <div class="row">
                                                        <div class="col-md-6 text-center">
                                                            <div class="result-label">Ratio Calculado:</div>
                                                            <div class="result-value" id="result-value-ratio_fruta">0</div>
                                                        </div>
                                                        <div class="col-md-6 text-center">
                                                            <div class="result-label">Classificação:</div>
                                                            <div class="result-value" id="result-class-ratio_fruta">-</div>
                                                        </div>
                                                    </div>
                                                    <div class="action-buttons">
                                                        <div class="action-button copy" onclick="copyResult('result-value-ratio_fruta', '')">
                                                            <i class="fas fa-copy"></i> Copiar
                                                        </div>
                                                        <div class="action-button reset" onclick="resetCalculator('form-ratio-fruta', 'result-ratio_fruta')">
                                                            <i class="fas fa-redo"></i> Limpar
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Calculadora de Correção de Acidez -->
                                <div class="col-md-6">
                                    <div class="card card-calculator">
                                        <div class="card-header-calculator">
                                            <i class="fas fa-vial me-2"></i> Correção de Acidez
                                        </div>
                                        <div class="card-body-calculator">
                                            <div class="calculation-description">
                                                Calcula a quantidade de ácido cítrico necessária para ajustar a acidez do suco.
                                            </div>
                                            <form id="form-correcao-acidez">
                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <div class="form-group">
                                                            <label class="form-label" for="acidez_atual">Acidez Atual (%):</label>
                                                            <input type="number" class="form-control" id="acidez_atual" placeholder="Acidez atual" step="0.01" required>
                                                            <div class="error-message" id="error-acidez_atual">Valor inválido</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="form-group">
                                                            <label class="form-label" for="acidez_desejada">Acidez Desejada (%):</label>
                                                            <input type="number" class="form-control" id="acidez_desejada" placeholder="Acidez desejada" step="0.01" required>
                                                            <div class="error-message" id="error-acidez_desejada">Valor inválido</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="form-group">
                                                            <label class="form-label" for="volume_suco">Volume de Suco (L):</label>
                                                            <input type="number" class="form-control" id="volume_suco" placeholder="Volume de suco" step="0.1" required>
                                                            <div class="error-message" id="error-volume_suco">Valor inválido</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="text-center mt-3">
                                                    <button type="button" class="btn btn-calculate" onclick="calculate('correcao_acidez')">
                                                        <i class="fas fa-calculator"></i> Calcular
                                                    </button>
                                                </div>
                                                <div class="result-box" id="result-correcao_acidez">
                                                    <div class="row">
                                                        <div class="col-md-12 text-center">
                                                            <div class="result-label">Ácido Cítrico a Adicionar:</div>
                                                            <div class="result-value" id="result-value-correcao_acidez">0</div>
                                                            <div class="result-unit">g</div>
                                                        </div>
                                                    </div>
                                                    <div class="action-buttons">
                                                        <div class="action-button copy" onclick="copyResult('result-value-correcao_acidez', 'g')">
                                                            <i class="fas fa-copy"></i> Copiar
                                                        </div>
                                                        <div class="action-button reset" onclick="resetCalculator('form-correcao-acidez', 'result-correcao_acidez')">
                                                            <i class="fas fa-redo"></i> Limpar
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Subtab: Processamento -->
                        <div class="tab-pane fade" id="juice-processing" role="tabpanel" aria-labelledby="juice-processing-tab">
                            <!-- Calculadora de Pasteurização -->
                            <div class="card card-calculator">
                                <div class="card-header-calculator">
                                    <i class="fas fa-temperature-high me-2"></i> Pasteurização (Unidades de Pasteurização)
                                </div>
                                <div class="card-body-calculator">
                                    <div class="calculation-description">
                                        Calcula as Unidades de Pasteurização (PU) com base na temperatura e tempo de retenção.
                                    </div>
                                    <div class="formula-box">
                                        <strong>Fórmula:</strong> PU = t × 1.393<sup>(T-60)</sup>
                                        <br>
                                        <small>Onde: t = tempo em minutos, T = temperatura em °C</small>
                                    </div>
                                    <form id="form-pasteurizacao">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="form-label" for="temperatura_pasteurizacao">Temperatura (°C):</label>
                                                    <input type="number" class="form-control" id="temperatura_pasteurizacao" placeholder="Digite a temperatura" step="0.1" required>
                                                    <div class="error-message" id="error-temperatura_pasteurizacao">Valor inválido</div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="form-label" for="tempo_retencao">Tempo de Retenção (min):</label>
                                                    <input type="number" class="form-control" id="tempo_retencao" placeholder="Digite o tempo" step="0.01" required>
                                                    <div class="error-message" id="error-tempo_retencao">Valor inválido</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-center mt-3">
                                            <button type="button" class="btn btn-calculate" onclick="calculate('pasteurizacao')">
                                                <i class="fas fa-calculator"></i> Calcular
                                            </button>
                                        </div>
                                        <div class="result-box" id="result-pasteurizacao">
                                            <div class="row">
                                                <div class="col-md-12 text-center">
                                                    <div class="result-label">Unidades de Pasteurização (PU):</div>
                                                    <div class="result-value" id="result-value-pasteurizacao">0</div>
                                                    <div class="result-unit">PU</div>
                                                </div>
                                            </div>
                                            <div class="action-buttons">
                                                <div class="action-button copy" onclick="copyResult('result-value-pasteurizacao', 'PU')">
                                                    <i class="fas fa-copy"></i> Copiar
                                                </div>
                                                <div class="action-button reset" onclick="resetCalculator('form-pasteurizacao', 'result-pasteurizacao')">
                                                    <i class="fas fa-redo"></i> Limpar
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Subtab: Formulações -->
                        <div class="tab-pane fade" id="juice-recipes" role="tabpanel" aria-labelledby="juice-recipes-tab">
                            <!-- Calculadora de Formulação de Bebidas -->
                            <div class="card card-calculator">
                                <div class="card-header-calculator">
                                    <i class="fas fa-blender me-2"></i> Formulação de Bebidas
                                </div>
                                <div class="card-body-calculator">
                                    <div class="calculation-description">
                                        Calcula a proporção de ingredientes para uma formulação específica.
                                    </div>
                                    <form id="form-formulacao">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="form-label" for="tipo_bebida">Tipo de Bebida:</label>
                                                    <select class="form-control" id="tipo_bebida">
                                                        <option value="nectar">Néctar</option>
                                                        <option value="refresco">Refresco</option>
                                                        <option value="suco">Suco Integral</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="form-label" for="volume_bebida">Volume Final (L):</label>
                                                    <input type="number" class="form-control" id="volume_bebida" placeholder="Digite o volume" step="0.1" required>
                                                    <div class="error-message" id="error-volume_bebida">Valor inválido</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-center mt-3">
                                            <button type="button" class="btn btn-calculate" onclick="calculate('formulacao')">
                                                <i class="fas fa-calculator"></i> Calcular
                                            </button>
                                        </div>
                                        <div class="result-box" id="result-formulacao">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="table-responsive">
                                                        <table class="table table-bordered">
                                                            <thead class="table-light">
                                                                <tr>
                                                                    <th>Ingrediente</th>
                                                                    <th>Quantidade</th>
                                                                    <th>Unidade</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="result-table-formulacao">
                                                                <!-- Os resultados serão preenchidos via JavaScript -->
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="action-buttons">
                                                <div class="action-button reset" onclick="resetCalculator('form-formulacao', 'result-formulacao')">
                                                    <i class="fas fa-redo"></i> Limpar
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Função para alternar a visibilidade das calculadoras
    function toggleCalculator(id) {
        const element = document.getElementById(id);
        const isActive = element.classList.contains('active');
        
        // Fechar todos os calculadores
        document.querySelectorAll('.calculator-body').forEach(calc => {
            calc.classList.remove('active');
        });
        
        // Resetar todos os ícones
        document.querySelectorAll('.calculator-title i.fas.fa-chevron-down, .calculator-title i.fas.fa-chevron-up').forEach(icon => {
            if (icon.id && icon.id.startsWith('icon-')) {
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
            }
        });
        
        // Se não estava ativo, torná-lo ativo
        if (!isActive) {
            element.classList.add('active');
            const icon = document.getElementById(`icon-${id}`);
            if (icon) {
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
            }
        }
    }
    
    // Função para validar formulários
    function validateForm(formId) {
        const form = document.getElementById(formId);
        let isValid = true;
        
        // Verificar todos os campos necessários
        const inputs = form.querySelectorAll('input[required]');
        inputs.forEach(input => {
            const errorElement = document.getElementById(`error-${input.id}`);
            if (!input.value || isNaN(parseFloat(input.value))) {
                if (errorElement) {
                    errorElement.style.display = 'block';
                }
                isValid = false;
            } else {
                if (errorElement) {
                    errorElement.style.display = 'none';
                }
            }
        });
        
        return isValid;
    }
    
    // Função para formatar resultado
    function formatResult(value, decimals = 2) {
        return parseFloat(value).toFixed(decimals);
    }

    // Função para copiar resultado para área de transferência
    function copyResult(elementId, unit) {
        const element = document.getElementById(elementId);
        const text = element.textContent + (unit ? ` ${unit}` : '');
        
        navigator.clipboard.writeText(text).then(() => {
            // Dar feedback visual
            element.classList.add('pulse');
            setTimeout(() => {
                element.classList.remove('pulse');
            }, 500);
            
            // Mostrar notificação
            alert('Valor copiado para a área de transferência!');
        }).catch(err => {
            console.error('Erro ao copiar: ', err);
        });
    }
    
    // Função para copiar resultado com unidade dinâmica
    function copyResultWithUnit(valueId, unitId) {
        const valueElement = document.getElementById(valueId);
        const unitElement = document.getElementById(unitId);
        const text = valueElement.textContent + ' ' + unitElement.textContent;
        
        navigator.clipboard.writeText(text).then(() => {
            // Dar feedback visual
            valueElement.classList.add('pulse');
            setTimeout(() => {
                valueElement.classList.remove('pulse');
            }, 500);
            
            // Mostrar notificação
            alert('Valor copiado para a área de transferência!');
        }).catch(err => {
            console.error('Erro ao copiar: ', err);
        });
    }
    
    // Função para resetar calculadora
    function resetCalculator(formId, resultBoxId) {
        // Resetar o formulário
        document.getElementById(formId).reset();
        
        // Esconder o resultado
        document.getElementById(resultBoxId).style.display = 'none';
        
        // Esconder mensagens de erro
        const errorElements = document.querySelectorAll(`#${formId} .error-message`);
        errorElements.forEach(el => {
            el.style.display = 'none';
        });
    }
    
    // Atualizar as opções de destino com base na unidade de origem
    function updateConversionDestinations() {
        const grupo = document.getElementById('unidade_origem').value;
        const destinoSelect = document.getElementById('unidade_destino');
        
        // Limpar opções atuais
        destinoSelect.innerHTML = '';
        
        // Se não selecionou um grupo válido, desabilitar
        if (grupo === 'grupo') {
            destinoSelect.disabled = true;
            destinoSelect.innerHTML = '<option value="">Selecione a unidade de origem primeiro</option>';
            return;
        }
        
        // Habilitar o select
        destinoSelect.disabled = false;
        
        // Adicionar opções baseadas no grupo
        let options = [];
        
        switch(grupo) {
            case 'volume':
                options = [
                    { value: 'mL', text: 'Mililitros (mL)' },
                    { value: 'L', text: 'Litros (L)' },
                    { value: 'm3', text: 'Metros cúbicos (m³)' },
                    { value: 'gal', text: 'Galões (gal)' }
                ];
                break;
            case 'massa':
                options = [
                    { value: 'mg', text: 'Miligramas (mg)' },
                    { value: 'g', text: 'Gramas (g)' },
                    { value: 'kg', text: 'Quilogramas (kg)' },
                    { value: 'ton', text: 'Toneladas (ton)' }
                ];
                break;
            case 'temperatura':
                options = [
                    { value: 'C', text: 'Celsius (°C)' },
                    { value: 'F', text: 'Fahrenheit (°F)' },
                    { value: 'K', text: 'Kelvin (K)' }
                ];
                break;
            case 'concentracao':
                options = [
                    { value: 'ppm', text: 'Partes por milhão (ppm)' },
                    { value: 'ppb', text: 'Partes por bilhão (ppb)' },
                    { value: 'mgL', text: 'Miligramas por litro (mg/L)' },
                    { value: 'gL', text: 'Gramas por litro (g/L)' },
                    { value: 'perc', text: 'Porcentagem (%)' }
                ];
                break;
        }
        
        // Adicionar as opções ao select
        options.forEach(opt => {
            const option = document.createElement('option');
            option.value = opt.value;
            option.textContent = opt.text;
            destinoSelect.appendChild(option);
        });
    }
    
    // Função para processar resultado da formulação
    function processRecipeResult(data, tipo) {
        const tableBody = document.getElementById('result-table-formulacao');
        tableBody.innerHTML = '';
        
        // Para cada ingrediente no resultado, adicionar uma linha na tabela
        data.ingredientes.forEach(ingrediente => {
            const row = document.createElement('tr');
            
            const nameCell = document.createElement('td');
            nameCell.textContent = ingrediente.nome;
            row.appendChild(nameCell);
            
            const quantityCell = document.createElement('td');
            quantityCell.textContent = formatResult(ingrediente.quantidade);
            row.appendChild(quantityCell);
            
            const unitCell = document.createElement('td');
            unitCell.textContent = ingrediente.unidade;
            row.appendChild(unitCell);
            
            tableBody.appendChild(row);
        });
    }
    
    // Função para enviar solicitação de cálculo
    function calculate(calculationType) {
        // Mapear tipo de cálculo para ID do formulário
        const formMappings = {
            'producao_200': 'form-producao200',
            'producao_litro': 'form-producaoLitro',
            'abaixar_brix': 'form-abaixarBrix',
            'ratio': 'form-ratio',
            'diluicao': 'form-diluicao',
            'conversao': 'form-conversao',
            'rendimento': 'form-rendimento',
            'consumo': 'form-consumo',
            'solucao': 'form-solucao',
            'ratio_fruta': 'form-ratio-fruta',
            'correcao_acidez': 'form-correcao-acidez',
            'pasteurizacao': 'form-pasteurizacao',
            'formulacao': 'form-formulacao'
        };
        
        const formId = formMappings[calculationType];
        
        // Validar formulário primeiro
        if (!validateForm(formId)) {
            return;
        }
        
        // Obter os dados conforme o tipo de cálculo
        let data = {
            tipo_calculo: calculationType
        };
        
        switch (calculationType) {
            case 'producao_200':
                data.peso_bruto = parseFloat(document.getElementById('peso_bruto_200').value);
                data.tara = parseFloat(document.getElementById('tara_200').value);
                break;
            case 'producao_litro':
                data.peso = parseFloat(document.getElementById('peso_total').value);
                data.densidade = parseFloat(document.getElementById('densidade').value);
                break;
            case 'abaixar_brix':
                data.brix_atual = parseFloat(document.getElementById('brix_atual').value);
                data.brix_desejado = parseFloat(document.getElementById('brix_desejado').value);
                data.volume_inicial = parseFloat(document.getElementById('volume_inicial').value);
                break;
            case 'ratio':
                data.brix = parseFloat(document.getElementById('brix_ratio').value);
                data.acidez = parseFloat(document.getElementById('acidez_ratio').value);
                break;
            case 'diluicao':
                data.conc_inicial = parseFloat(document.getElementById('conc_inicial').value);
                data.vol_inicial = parseFloat(document.getElementById('vol_inicial').value);
                data.vol_final = parseFloat(document.getElementById('vol_final').value);
                data.unidade = document.getElementById('unidade_conc').value;
                break;
            case 'conversao':
                data.valor = parseFloat(document.getElementById('valor_converter').value);
                data.de = document.getElementById('unidade_origem').value;
                data.para = document.getElementById('unidade_destino').value;
                break;
            case 'rendimento':
                data.entrada = parseFloat(document.getElementById('entrada_material').value);
                data.saida = parseFloat(document.getElementById('saida_material').value);
                break;
            case 'consumo':
                data.quantidade_insumo = parseFloat(document.getElementById('quantidade_insumo').value);
                data.unidades_produzidas = parseInt(document.getElementById('unidades_produzidas').value);
                break;
            case 'solucao':
                data.concentracao = parseFloat(document.getElementById('concentracao_desejada').value);
                data.volume = parseFloat(document.getElementById('volume_solucao').value);
                data.tipo_solucao = document.getElementById('tipo_solucao').value;
                break;
            case 'ratio_fruta':
                data.tipo_fruta = document.getElementById('tipo_fruta').value;
                data.brix = parseFloat(document.getElementById('brix_fruta').value);
                data.acidez = parseFloat(document.getElementById('acidez_fruta').value);
                break;
            case 'correcao_acidez':
                data.acidez_atual = parseFloat(document.getElementById('acidez_atual').value);
                data.acidez_desejada = parseFloat(document.getElementById('acidez_desejada').value);
                data.volume_suco = parseFloat(document.getElementById('volume_suco').value);
                break;
            case 'pasteurizacao':
                data.temperatura = parseFloat(document.getElementById('temperatura_pasteurizacao').value);
                data.tempo = parseFloat(document.getElementById('tempo_retencao').value);
                break;
            case 'formulacao':
                data.tipo_bebida = document.getElementById('tipo_bebida').value;
                data.volume = parseFloat(document.getElementById('volume_bebida').value);
                break;
        }
        
        // Enviar a solicitação para o servidor
        fetch('/calculos/api/calculate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert('Erro: ' + data.error);
                return;
            }
            
            // Mostrar resultado
            const resultBox = document.getElementById(`result-${calculationType}`);
            resultBox.style.display = 'block';
            
            // Processamento especial para formulação
            if (calculationType === 'formulacao') {
                processRecipeResult(data, document.getElementById('tipo_bebida').value);
                return;
            }
            
            // Processamento especial para ratio por fruta
            if (calculationType === 'ratio_fruta') {
                const resultValueElement = document.getElementById(`result-value-${calculationType}`);
                resultValueElement.textContent = formatResult(data.resultado);
                
                const resultClassElement = document.getElementById(`result-class-${calculationType}`);
                resultClassElement.textContent = data.classificacao;
                resultClassElement.className = `result-value ${data.status}`;
                
                // Animar resultado
                resultValueElement.classList.add('pulse');
                setTimeout(() => {
                    resultValueElement.classList.remove('pulse');
                }, 500);
                return;
            }
            
            const resultValueElement = document.getElementById(`result-value-${calculationType}`);
            resultValueElement.textContent = formatResult(data.resultado);
            
            // Atualizar unidade se aplicável
            if (calculationType === 'diluicao') {
                document.getElementById('result-unit-diluicao').textContent = 
                    document.getElementById('unidade_conc').value;
            } else if (calculationType === 'conversao') {
                document.getElementById('result-unit-conversao').textContent = 
                    document.getElementById('unidade_destino').options[
                        document.getElementById('unidade_destino').selectedIndex
                    ].text.match(/\(([^)]+)\)/)[1];
            } else if (calculationType === 'solucao') {
                const tipoSolucao = document.getElementById('tipo_solucao').value;
                document.getElementById('result-unit-solucao').textContent = 
                    tipoSolucao === 'massa' ? 'g' : 'mL';
            }
            
            // Animar resultado
            resultValueElement.classList.add('pulse');
            setTimeout(() => {
                resultValueElement.classList.remove('pulse');
            }, 500);
        })
        .catch(error => {
            console.error('Erro:', error);
            alert('Ocorreu um erro ao processar o cálculo. Por favor, tente novamente.');
        });
    }
</script>
{% endblock %}