{% extends "base.html" %}

{% block title %}Cálculos Técnicos - Zelopack{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/calculos.css') }}">
{% endblock %}

{% block content %}
<div class="container-calculos">
    <!-- Sidebar para seleção de cálculos -->
    <div class="sidebar-calculos">
        <div class="sidebar-header">
            <h5 class="mb-0"><i class="fas fa-calculator me-2"></i> Cálculos Técnicos</h5>
        </div>
        
        <div class="sidebar-search position-relative">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="form-control search-input" id="searchCalculo" placeholder="Buscar cálculo...">
        </div>
        
        <ul class="calculo-list" id="calculoList">
            <!-- Categoria: Produção -->
            <li class="calculo-category" data-category="producao">
                <div><i class="fas fa-industry"></i> Produção</div>
                <i class="fas fa-chevron-down"></i>
            </li>
            <li class="calculo-item active" data-target="producao-200g">
                <i class="fas fa-balance-scale"></i> Produção 200g
            </li>
            <li class="calculo-item" data-target="producao-litro">
                <i class="fas fa-tint"></i> Produção Litro
            </li>
            <li class="calculo-item" data-target="peso-bruto">
                <i class="fas fa-weight"></i> Peso Bruto
            </li>
            <li class="calculo-item" data-target="perda-base">
                <i class="fas fa-chart-line"></i> Perda de Base
            </li>
            <li class="calculo-item" data-target="acucar-puxar">
                <i class="fas fa-cubes"></i> Quantidade de Açúcar
            </li>
            <li class="calculo-item" data-target="conversao-acucar">
                <i class="fas fa-exchange-alt"></i> Conversão Cristal ⇄ Líquido
            </li>
            <li class="calculo-item" data-target="zeragem-embalagem">
                <i class="fas fa-box"></i> Zeragem de Embalagem
            </li>
            
            <!-- Categoria: Laboratório -->
            <li class="calculo-category" data-category="laboratorio">
                <div><i class="fas fa-flask"></i> Laboratório</div>
                <i class="fas fa-chevron-down"></i>
            </li>
            <li class="calculo-item" data-target="brix-corrigido">
                <i class="fas fa-thermometer-half"></i> Brix Corrigido
            </li>
            <li class="calculo-item" data-target="corantes">
                <i class="fas fa-fill-drip"></i> Corantes
            </li>
            <li class="calculo-item" data-target="densidade">
                <i class="fas fa-atom"></i> Densidade
            </li>
            <li class="calculo-item" data-target="ratio">
                <i class="fas fa-calculator"></i> Ratio
            </li>
            <li class="calculo-item" data-target="acidez">
                <i class="fas fa-eye-dropper"></i> Acidez
            </li>
            <li class="calculo-item" data-target="vitamina-c">
                <i class="fas fa-apple-alt"></i> Vitamina C
            </li>
            <li class="calculo-item" data-target="aumentar-acidez">
                <i class="fas fa-plus-circle"></i> Aumentar Acidez
            </li>
            <li class="calculo-item" data-target="diminuir-acidez">
                <i class="fas fa-minus-circle"></i> Diminuir Acidez
            </li>
            <li class="calculo-item" data-target="ratio-brix">
                <i class="fas fa-balance-scale-right"></i> Ratio - Brix
            </li>
            <li class="calculo-item" data-target="ratio-acidez">
                <i class="fas fa-balance-scale-left"></i> Ratio - Acidez
            </li>
            <li class="calculo-item" data-target="abaixar-brix">
                <i class="fas fa-water"></i> Abaixar Brix
            </li>
            
            <!-- Categoria: Finalização -->
            <li class="calculo-category" data-category="finalizacao">
                <div><i class="fas fa-tasks"></i> Finalização</div>
                <i class="fas fa-chevron-down"></i>
            </li>
            <li class="calculo-item" data-target="finalizacao-tanque">
                <i class="fas fa-database"></i> Finalização de Tanque
            </li>
            <li class="calculo-item" data-target="mistura-tanques">
                <i class="fas fa-exchange-alt"></i> Mistura de Tanques
            </li>
            <li class="calculo-item" data-target="calcular-soda">
                <i class="fas fa-flask"></i> Cálculo de Soda
            </li>
            <li class="calculo-item" data-target="soda-diversey">
                <i class="fas fa-tint"></i> Soda - Diversey
            </li>
            
            <!-- Categoria: Qualidade -->
            <li class="calculo-category" data-category="qualidade">
                <div><i class="fas fa-check-circle"></i> Qualidade</div>
                <i class="fas fa-chevron-down"></i>
            </li>
            <li class="calculo-item" data-target="ph-corrigido">
                <i class="fas fa-filter"></i> pH Corrigido
            </li>
            <li class="calculo-item" data-target="teor-solidos">
                <i class="fas fa-cubes"></i> Teor de Sólidos
            </li>
        </ul>
    </div>
    
    <!-- Conteúdo principal - mostra apenas um cálculo por vez -->
    <div class="content-calculos">
        <!-- Área de Cálculo: Produção 200g -->
        <div class="calculo-area active" id="producao-200g-area">
            <h2><i class="fas fa-balance-scale"></i> Produção 200g</h2>
            
            <div class="calculo-description">
                <p>Determinação de peso líquido de embalagens de 200g, subtraindo a tara (peso da embalagem) do peso bruto. Realiza a verificação do peso em relação ao especificado, indicando se está conforme ou não.</p>
            </div>
            
            <div class="calculo-form">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="peso_bruto">
                                Peso Bruto
                                <span class="unit">(gramas)</span>
                                <i class="fas fa-info-circle help-icon" data-bs-toggle="tooltip" title="Peso total do produto com a embalagem"></i>
                            </label>
                            <div class="input-with-unit">
                                <input type="number" class="form-control" id="peso_bruto" step="0.01" placeholder="0.00">
                                <span class="input-unit">g</span>
                            </div>
                            <div class="form-text">Medido na balança analítica</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="peso_tara">
                                Tara (Embalagem)
                                <span class="unit">(gramas)</span>
                                <i class="fas fa-info-circle help-icon" data-bs-toggle="tooltip" title="Peso da embalagem vazia"></i>
                            </label>
                            <div class="input-with-unit">
                                <input type="number" class="form-control" id="peso_tara" step="0.01" placeholder="0.00">
                                <span class="input-unit">g</span>
                            </div>
                            <div class="form-text">Valor médio de 10 embalagens</div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="peso_especificado">
                                Peso Especificado
                                <span class="unit">(gramas)</span>
                                <i class="fas fa-info-circle help-icon" data-bs-toggle="tooltip" title="Peso líquido padrão do produto"></i>
                            </label>
                            <div class="input-with-unit">
                                <input type="number" class="form-control" id="peso_especificado" value="200.00" step="0.01">
                                <span class="input-unit">g</span>
                            </div>
                            <div class="form-text">Valor definido pela especificação</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="tolerancia">
                                Tolerância
                                <span class="unit">(%)</span>
                                <i class="fas fa-info-circle help-icon" data-bs-toggle="tooltip" title="Percentual de tolerância permitido"></i>
                            </label>
                            <div class="input-with-unit">
                                <input type="number" class="form-control" id="tolerancia" value="2.5" step="0.1">
                                <span class="input-unit">%</span>
                            </div>
                            <div class="form-text">Geralmente entre 2-3%</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="actions-row">
                <button class="btn btn-calculate" id="calculaPeso200g">
                    <i class="fas fa-calculator"></i> Calcular Peso Líquido
                </button>
                <button class="btn btn-secondary btn-clear" id="limparPeso200g">
                    <i class="fas fa-eraser"></i> Limpar
                </button>
                <button class="btn btn-success btn-save" id="salvarPeso200g">
                    <i class="fas fa-save"></i> Salvar
                </button>
            </div>
            
            <div class="resultado-area" id="resultado-peso200g">
                <div class="resultado-header">
                    <h4><i class="fas fa-check-circle"></i> Resultado do Cálculo</h4>
                    <button class="btn btn-sm btn-primary" id="printResultado">
                        <i class="fas fa-print"></i> Imprimir
                    </button>
                </div>
                
                <div class="resultado-value" id="valor-peso-liquido">198.50 g</div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="alert alert-primary peso-status">
                            <strong><i class="fas fa-info-circle me-2"></i> Status:</strong>
                            <span id="status-peso">Dentro da tolerância</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="alert alert-primary peso-desvio">
                            <strong><i class="fas fa-percentage me-2"></i> Desvio:</strong>
                            <span id="desvio-peso">-0.75%</span>
                        </div>
                    </div>
                </div>
                
                <div class="resultado-formula">
                    <div>Peso Líquido = Peso Bruto - Tara</div>
                    <div>Peso Líquido = <span id="formula-bruto">217.50</span> - <span id="formula-tara">19.00</span> = <span id="formula-liquido">198.50</span> g</div>
                </div>
                
                <div class="resultado-details">
                    <div class="details-item">
                        <span>Tolerância Mínima:</span>
                        <span id="tolerancia-min">195.00 g</span>
                    </div>
                    <div class="details-item">
                        <span>Tolerância Máxima:</span>
                        <span id="tolerancia-max">205.00 g</span>
                    </div>
                    <div class="details-item">
                        <span>Diferença Absoluta:</span>
                        <span id="diferenca-abs">-1.50 g</span>
                    </div>
                </div>
                
                <div class="visual-hint">
                    <i class="fas fa-lightbulb"></i>
                    <div>
                        <strong>Dica:</strong> Para aumentar a precisão, realize várias medições e use a média dos valores obtidos.
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Área de Cálculo: Densidade -->
        <div class="calculo-area" id="densidade-area">
            <h2><i class="fas fa-atom"></i> Densidade</h2>
            
            <div class="calculo-description">
                <p>Calcula a densidade com base na razão entre massa e volume. Um parâmetro essencial para converter entre peso e volume nos processos de produção.</p>
            </div>
            
            <div class="calculo-form">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="densidade_massa">
                                Massa
                                <span class="unit">(gramas)</span>
                                <i class="fas fa-info-circle help-icon" data-bs-toggle="tooltip" title="Massa da amostra"></i>
                            </label>
                            <div class="input-with-unit">
                                <input type="number" class="form-control" id="densidade_massa" step="0.01" placeholder="0.00">
                                <span class="input-unit">g</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="densidade_volume">
                                Volume
                                <span class="unit">(mililitros)</span>
                                <i class="fas fa-info-circle help-icon" data-bs-toggle="tooltip" title="Volume da amostra"></i>
                            </label>
                            <div class="input-with-unit">
                                <input type="number" class="form-control" id="densidade_volume" step="0.1" placeholder="0.0">
                                <span class="input-unit">mL</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="actions-row">
                <button class="btn btn-calculate" id="calculaDensidade">
                    <i class="fas fa-calculator"></i> Calcular Densidade
                </button>
                <button class="btn btn-secondary btn-clear" id="limparDensidade">
                    <i class="fas fa-eraser"></i> Limpar
                </button>
                <button class="btn btn-success btn-save" id="salvarDensidade">
                    <i class="fas fa-save"></i> Salvar
                </button>
            </div>
            
            <div class="resultado-area" id="resultado-densidade" style="display:none;">
                <!-- Preenchido via JavaScript -->
            </div>
        </div>
        
        <!-- Área de Cálculo: Ratio -->
        <div class="calculo-area" id="ratio-area">
            <h2><i class="fas fa-calculator"></i> Ratio</h2>
            
            <div class="calculo-description">
                <p>Cálculo da relação entre Brix e Acidez, um importante indicador do perfil sensorial do produto. Um ratio mais elevado indica maior doçura relativa.</p>
            </div>
            
            <div class="calculo-form">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="ratio_brix">
                                Brix
                                <span class="unit">(°Bx)</span>
                                <i class="fas fa-info-circle help-icon" data-bs-toggle="tooltip" title="Conteúdo de açúcares solúveis"></i>
                            </label>
                            <div class="input-with-unit">
                                <input type="number" class="form-control" id="ratio_brix" step="0.1" placeholder="0.0">
                                <span class="input-unit">°Bx</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="ratio_acidez">
                                Acidez
                                <span class="unit">(%)</span>
                                <i class="fas fa-info-circle help-icon" data-bs-toggle="tooltip" title="Acidez titulável"></i>
                            </label>
                            <div class="input-with-unit">
                                <input type="number" class="form-control" id="ratio_acidez" step="0.01" placeholder="0.00">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="actions-row">
                <button class="btn btn-calculate" id="calculaRatio">
                    <i class="fas fa-calculator"></i> Calcular Ratio
                </button>
                <button class="btn btn-secondary btn-clear" id="limparRatio">
                    <i class="fas fa-eraser"></i> Limpar
                </button>
                <button class="btn btn-success btn-save" id="salvarRatio">
                    <i class="fas fa-save"></i> Salvar
                </button>
            </div>
            
            <div class="resultado-area" id="resultado-ratio" style="display:none;">
                <!-- Preenchido via JavaScript -->
            </div>
        </div>
        
        <!-- Área de Cálculo: Acidez -->
        <div class="calculo-area" id="acidez-area">
            <h2><i class="fas fa-eye-dropper"></i> Acidez</h2>
            
            <div class="calculo-description">
                <p>Cálculo padrão da acidez titulável de um produto, baseado no volume de hidróxido de sódio utilizado na titulação.</p>
            </div>
            
            <div class="calculo-form">
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="volume_amostra">
                                Volume da Amostra
                                <span class="unit">(mL)</span>
                                <i class="fas fa-info-circle help-icon" data-bs-toggle="tooltip" title="Volume da amostra utilizada"></i>
                            </label>
                            <div class="input-with-unit">
                                <input type="number" class="form-control" id="volume_amostra" step="0.1" placeholder="0.0">
                                <span class="input-unit">mL</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="fator_titulacao">
                                Fator de Titulação
                                <i class="fas fa-info-circle help-icon" data-bs-toggle="tooltip" title="Fator do NaOH utilizado"></i>
                            </label>
                            <input type="number" class="form-control" id="fator_titulacao" step="0.001" placeholder="0.000">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="volume_naoh">
                                Volume NaOH
                                <span class="unit">(mL)</span>
                                <i class="fas fa-info-circle help-icon" data-bs-toggle="tooltip" title="Volume de NaOH gasto na titulação"></i>
                            </label>
                            <div class="input-with-unit">
                                <input type="number" class="form-control" id="volume_naoh" step="0.1" placeholder="0.0">
                                <span class="input-unit">mL</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="actions-row">
                <button class="btn btn-calculate" id="calculaAcidez">
                    <i class="fas fa-calculator"></i> Calcular Acidez
                </button>
                <button class="btn btn-secondary btn-clear" id="limparAcidez">
                    <i class="fas fa-eraser"></i> Limpar
                </button>
                <button class="btn btn-success btn-save" id="salvarAcidez">
                    <i class="fas fa-save"></i> Salvar
                </button>
            </div>
            
            <div class="resultado-area" id="resultado-acidez" style="display:none;">
                <!-- Preenchido via JavaScript -->
            </div>
        </div>
        
        <!-- Área de Cálculo: Produção Litro -->
        <div class="calculo-area" id="producao-litro-area">
            <h2><i class="fas fa-tint"></i> Produção Litro</h2>
            
            <div class="calculo-description">
                <p>Calcula o volume final de produção com base no peso e densidade do produto, convertendo peso em litros.</p>
            </div>
            
            <div class="calculo-form">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="peso_total">
                                Peso Total
                                <span class="unit">(kg)</span>
                                <i class="fas fa-info-circle help-icon" data-bs-toggle="tooltip" title="Peso total do produto"></i>
                            </label>
                            <div class="input-with-unit">
                                <input type="number" class="form-control" id="peso_total" step="0.1" placeholder="0.0">
                                <span class="input-unit">kg</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="densidade_pl">
                                Densidade
                                <span class="unit">(kg/L)</span>
                                <i class="fas fa-info-circle help-icon" data-bs-toggle="tooltip" title="Densidade do produto"></i>
                            </label>
                            <div class="input-with-unit">
                                <input type="number" class="form-control" id="densidade_pl" step="0.001" value="1.045">
                                <span class="input-unit">kg/L</span>
                            </div>
                            <div class="form-text">Típico para sucos: 1.040-1.050 kg/L</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="actions-row">
                <button class="btn btn-calculate" id="calculaProducaoLitro">
                    <i class="fas fa-calculator"></i> Calcular Volume
                </button>
                <button class="btn btn-secondary btn-clear" id="limparProducaoLitro">
                    <i class="fas fa-eraser"></i> Limpar
                </button>
                <button class="btn btn-success btn-save" id="salvarProducaoLitro">
                    <i class="fas fa-save"></i> Salvar
                </button>
            </div>
            
            <div class="resultado-area" id="resultado-producao-litro" style="display:none;">
                <!-- Preenchido via JavaScript -->
            </div>
        </div>
        
        <!-- Área de Cálculo: Densidade -->
        <div class="calculo-area" id="densidade-area">
            <h2><i class="fas fa-atom"></i> Densidade</h2>
            
            <div class="calculo-description">
                <p>Calcula a densidade com base na razão entre massa e volume.</p>
            </div>
            
            <div class="calculo-form">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="massa_densidade">
                                Massa
                                <span class="unit">(g)</span>
                            </label>
                            <div class="input-with-unit">
                                <input type="number" class="form-control" id="massa_densidade" step="0.01" placeholder="0.00">
                                <span class="input-unit">g</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="volume_densidade">
                                Volume
                                <span class="unit">(mL)</span>
                            </label>
                            <div class="input-with-unit">
                                <input type="number" class="form-control" id="volume_densidade" step="0.01" placeholder="0.00">
                                <span class="input-unit">mL</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="actions-row">
                <button class="btn btn-calculate" id="calcularDensidade">
                    <i class="fas fa-calculator"></i> Calcular Densidade
                </button>
                <button class="btn btn-secondary btn-clear">
                    <i class="fas fa-eraser"></i> Limpar
                </button>
            </div>
            
            <div class="resultado-area" id="resultado_area_densidade" style="display:none;">
                <!-- Preenchido via JavaScript -->
            </div>
        </div>
        
        <!-- Área de Cálculo: Ratio -->
        <div class="calculo-area" id="ratio-area">
            <h2><i class="fas fa-calculator"></i> Ratio</h2>
            
            <div class="calculo-description">
                <p>Relação simples entre Brix e Acidez. Importante indicador de qualidade e maturação de sucos cítricos.</p>
            </div>
            
            <div class="calculo-form">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="brix_ratio">
                                Brix
                                <span class="unit">(°Bx)</span>
                            </label>
                            <div class="input-with-unit">
                                <input type="number" class="form-control" id="brix_ratio" step="0.1" placeholder="0.0">
                                <span class="input-unit">°Bx</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="acidez_ratio">
                                Acidez
                                <span class="unit">(%)</span>
                            </label>
                            <div class="input-with-unit">
                                <input type="number" class="form-control" id="acidez_ratio" step="0.01" placeholder="0.00">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="actions-row">
                <button class="btn btn-calculate" id="calcularRatio">
                    <i class="fas fa-calculator"></i> Calcular Ratio
                </button>
                <button class="btn btn-secondary btn-clear">
                    <i class="fas fa-eraser"></i> Limpar
                </button>
            </div>
            
            <div class="resultado-area" id="resultado_area_ratio" style="display:none;">
                <!-- Preenchido via JavaScript -->
            </div>
        </div>
        
        <!-- Área de Cálculo: Acidez -->
        <div class="calculo-area" id="acidez-area">
            <h2><i class="fas fa-eye-dropper"></i> Acidez</h2>
            
            <div class="calculo-description">
                <p>Cálculo padrão da acidez de um produto baseado na titulação com NaOH.</p>
            </div>
            
            <div class="calculo-form">
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="volume_amostra_acidez">
                                Volume da Amostra
                                <span class="unit">(mL)</span>
                            </label>
                            <div class="input-with-unit">
                                <input type="number" class="form-control" id="volume_amostra_acidez" step="0.1" placeholder="0.0">
                                <span class="input-unit">mL</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="fator_naoh">
                                Fator NaOH
                            </label>
                            <input type="number" class="form-control" id="fator_naoh" step="0.001" placeholder="0.000">
                            <div class="form-text">Fator de correção do NaOH</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="volume_naoh">
                                Volume NaOH
                                <span class="unit">(mL)</span>
                            </label>
                            <div class="input-with-unit">
                                <input type="number" class="form-control" id="volume_naoh" step="0.1" placeholder="0.0">
                                <span class="input-unit">mL</span>
                            </div>
                            <div class="form-text">Volume gasto na titulação</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="actions-row">
                <button class="btn btn-calculate" id="calcularAcidez">
                    <i class="fas fa-calculator"></i> Calcular Acidez
                </button>
                <button class="btn btn-secondary btn-clear">
                    <i class="fas fa-eraser"></i> Limpar
                </button>
            </div>
            
            <div class="resultado-area" id="resultado_area_acidez" style="display:none;">
                <!-- Preenchido via JavaScript -->
            </div>
        </div>
        
        <!-- Espaço reservado para outros cálculos -->
        <div class="empty-state" id="calculo-empty-state">
            <div>
                <i class="fas fa-calculator fa-3x mb-3"></i>
                <h4>Selecione um cálculo</h4>
                <p>Escolha um dos cálculos disponíveis no menu lateral para começar.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log("Inicializando cálculos...");
    
    // Função para mostrar/esconder áreas de cálculo
    function showCalculo(targetId) {
        // Ocultar todas as áreas de cálculo
        document.querySelectorAll('.calculo-area').forEach(function(area) {
            area.classList.remove('active');
        });
        
        // Mostrar a área selecionada
        const targetArea = document.getElementById(targetId + '-area');
        if (targetArea) {
            targetArea.classList.add('active');
        }
        
        // Atualizar os itens ativos no menu
        document.querySelectorAll('.calculo-item').forEach(function(item) {
            item.classList.remove('active');
        });
        
        // Destacar o item de menu selecionado
        const menuItem = document.querySelector(`.calculo-item[data-target="${targetId}"]`);
        if (menuItem) {
            menuItem.classList.add('active');
        }
    }
    
    // Adicionar eventos de clique nos itens de menu
    document.querySelectorAll('.calculo-item').forEach(function(item) {
        item.addEventListener('click', function() {
            const targetId = this.getAttribute('data-target');
            showCalculo(targetId);
        });
    });
    
    // Eventos para cálculo de produção 200g
    const btnCalculaPeso = document.getElementById('calculaPeso200g');
    if (btnCalculaPeso) {
        btnCalculaPeso.addEventListener('click', function() {
            const pesoBruto = parseFloat(document.getElementById('peso_bruto').value) || 0;
            const pesoTara = parseFloat(document.getElementById('peso_tara').value) || 0;
            const pesoEspecificado = parseFloat(document.getElementById('peso_especificado').value) || 200;
            const tolerancia = parseFloat(document.getElementById('tolerancia').value) || 2.5;
            
            // Cálculo do peso líquido
            const pesoLiquido = pesoBruto - pesoTara;
            
            // Mostrar resultado
            document.getElementById('valor-peso-liquido').textContent = pesoLiquido.toFixed(2) + ' g';
            
            // Cálculo de tolerâncias
            const limiteInferior = pesoEspecificado * (1 - tolerancia/100);
            const limiteSuperior = pesoEspecificado * (1 + tolerancia/100);
            const diferencaAbsoluta = pesoLiquido - pesoEspecificado;
            const desvioPercentual = (diferencaAbsoluta / pesoEspecificado) * 100;
            
            // Verificação do status
            let status = '';
            if (pesoLiquido >= limiteInferior && pesoLiquido <= limiteSuperior) {
                status = 'Dentro da tolerância';
                document.querySelector('.peso-status').className = 'alert alert-success peso-status';
            } else if (pesoLiquido < limiteInferior) {
                status = 'Abaixo da tolerância';
                document.querySelector('.peso-status').className = 'alert alert-danger peso-status';
            } else {
                status = 'Acima da tolerância';
                document.querySelector('.peso-status').className = 'alert alert-danger peso-status';
            }
            
            // Atualizar todos os elementos
            document.getElementById('status-peso').textContent = status;
            document.getElementById('desvio-peso').textContent = desvioPercentual.toFixed(2) + '%';
            document.getElementById('formula-bruto').textContent = pesoBruto.toFixed(2);
            document.getElementById('formula-tara').textContent = pesoTara.toFixed(2);
            document.getElementById('formula-liquido').textContent = pesoLiquido.toFixed(2);
            document.getElementById('tolerancia-min').textContent = limiteInferior.toFixed(2) + ' g';
            document.getElementById('tolerancia-max').textContent = limiteSuperior.toFixed(2) + ' g';
            document.getElementById('diferenca-abs').textContent = diferencaAbsoluta.toFixed(2) + ' g';
            
            // Mostrar a área de resultado
            document.getElementById('resultado-peso200g').style.display = 'block';
        });
    }
    
    // Implementação para Densidade
    const btnCalculaDensidade = document.getElementById('calculaDensidade');
    if (btnCalculaDensidade) {
        btnCalculaDensidade.addEventListener('click', function() {
            const massa = parseFloat(document.getElementById('densidade_massa').value) || 0;
            const volume = parseFloat(document.getElementById('densidade_volume').value) || 0;
            
            if (volume === 0) {
                alert('O volume não pode ser zero!');
                return;
            }
            
            const densidade = massa / volume;
            
            // Criar área de resultado se não existir
            let resultadoArea = document.getElementById('resultado-densidade');
            resultadoArea.innerHTML = `
                <div class="resultado-header">
                    <h4><i class="fas fa-atom"></i> Resultado do Cálculo</h4>
                </div>
                <div class="resultado-value">${densidade.toFixed(4)} g/mL</div>
                <div class="resultado-formula">
                    <div>Densidade = Massa / Volume</div>
                    <div>Densidade = ${massa.toFixed(2)} g / ${volume.toFixed(2)} mL = ${densidade.toFixed(4)} g/mL</div>
                </div>
            `;
            
            // Mostrar a área de resultado
            resultadoArea.style.display = 'block';
        });
    }
    
    // Implementação para Ratio
    const btnCalculaRatio = document.getElementById('calculaRatio');
    if (btnCalculaRatio) {
        btnCalculaRatio.addEventListener('click', function() {
            const brix = parseFloat(document.getElementById('ratio_brix').value) || 0;
            const acidez = parseFloat(document.getElementById('ratio_acidez').value) || 0;
            
            if (acidez === 0) {
                alert('A acidez não pode ser zero!');
                return;
            }
            
            const ratio = brix / acidez;
            
            // Criar área de resultado
            let resultadoArea = document.getElementById('resultado-ratio');
            if (!resultadoArea) {
                resultadoArea = document.createElement('div');
                resultadoArea.id = 'resultado-ratio';
                resultadoArea.className = 'resultado-area';
                document.getElementById('ratio-area').appendChild(resultadoArea);
            }
            
            resultadoArea.innerHTML = `
                <div class="resultado-header">
                    <h4><i class="fas fa-calculator"></i> Resultado do Cálculo</h4>
                </div>
                <div class="resultado-value">${ratio.toFixed(2)}</div>
                <div class="resultado-formula">
                    <div>Ratio = Brix / Acidez</div>
                    <div>Ratio = ${brix.toFixed(2)} / ${acidez.toFixed(3)} = ${ratio.toFixed(2)}</div>
                </div>
            `;
            
            // Mostrar a área de resultado
            resultadoArea.style.display = 'block';
        });
    }
    
    // Implementação para Acidez
    const btnCalculaAcidez = document.getElementById('calculaAcidez');
    if (btnCalculaAcidez) {
        btnCalculaAcidez.addEventListener('click', function() {
            const volume = parseFloat(document.getElementById('acidez_volume').value) || 0;
            const naohGasto = parseFloat(document.getElementById('acidez_naoh').value) || 0;
            const fatorCorrecao = parseFloat(document.getElementById('acidez_fator').value) || 1;
            const meq = parseFloat(document.getElementById('acidez_meq').value) || 0.064;
            
            if (volume === 0) {
                alert('O volume da amostra não pode ser zero!');
                return;
            }
            
            const acidez = (naohGasto * fatorCorrecao * meq * 100) / volume;
            
            // Criar área de resultado
            let resultadoArea = document.getElementById('resultado_area_acidez');
            if (!resultadoArea) {
                resultadoArea = document.createElement('div');
                resultadoArea.id = 'resultado_area_acidez';
                resultadoArea.className = 'resultado-area';
                document.getElementById('acidez-area').appendChild(resultadoArea);
            }
            
            resultadoArea.innerHTML = `
                <div class="resultado-header">
                    <h4><i class="fas fa-eye-dropper"></i> Resultado do Cálculo</h4>
                </div>
                <div class="resultado-value">${acidez.toFixed(3)} g/100mL</div>
                <div class="resultado-formula">
                    <div>Acidez = (V<sub>NaOH</sub> × F × meq × 100) / V<sub>amostra</sub></div>
                    <div>Acidez = (${naohGasto.toFixed(2)} mL × ${fatorCorrecao.toFixed(4)} × ${meq} × 100) / ${volume.toFixed(2)} mL = ${acidez.toFixed(3)} g/100mL</div>
                </div>
            `;
            
            // Mostrar a área de resultado
            resultadoArea.style.display = 'block';
        });
    }
    
    // Expandir/colapsar categorias
    document.querySelectorAll('.calculo-category').forEach(function(category) {
        category.addEventListener('click', function() {
            this.classList.toggle('collapsed');
            
            // Encontrar todos os itens de cálculo após esta categoria até a próxima categoria
            let nextElement = this.nextElementSibling;
            while (nextElement && !nextElement.classList.contains('calculo-category')) {
                nextElement.classList.toggle('hidden');
                nextElement = nextElement.nextElementSibling;
            }
            
            // Alternar o ícone
            const icon = this.querySelector('i.fas.fa-chevron-down, i.fas.fa-chevron-right');
            if (icon) {
                if (icon.classList.contains('fa-chevron-down')) {
                    icon.classList.remove('fa-chevron-down');
                    icon.classList.add('fa-chevron-right');
                } else {
                    icon.classList.remove('fa-chevron-right');
                    icon.classList.add('fa-chevron-down');
                }
            }
        });
    });
    
    // Botões para limpar formulários
    document.querySelectorAll('.btn-clear').forEach(function(btn) {
        btn.addEventListener('click', function() {
            // Encontrar o formulário pai
            const area = this.closest('.calculo-area');
            if (area) {
                // Limpar todos os inputs
                area.querySelectorAll('input').forEach(function(input) {
                    if (input.type === 'number' || input.type === 'text') {
                        input.value = '';
                    }
                });
                
                // Esconder áreas de resultado
                area.querySelectorAll('.resultado-area').forEach(function(resultArea) {
                    resultArea.style.display = 'none';
                });
            }
        });
    });
    
    console.log("Cálculos inicializados com sucesso!");
});
</script>
{% endblock %}