{% extends 'base.html' %}

{% block title %}Cálculos Técnicos Avançados - Zelopack{% endblock %}

{% block styles %}
<style>
    .calculator-container {
        padding-bottom: 50px;
    }
    
    .calc-filter {
        position: sticky;
        top: 70px;
        background-color: #fff;
        padding: 15px;
        border-radius: 5px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        z-index: 100;
        margin-bottom: 20px;
    }
    
    .calc-card {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        margin-bottom: 30px;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .calc-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    }
    
    .calc-card .calc-header {
        background: linear-gradient(135deg, #0097A7 0%, #006064 100%);
        color: white;
        padding: 15px 20px;
        font-weight: 600;
        font-size: 1.1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .calc-card .calc-body {
        padding: 20px;
    }
    
    .calc-card .calc-footer {
        padding: 15px 20px;
        background-color: #f8f9fa;
        text-align: right;
    }
    
    .calc-icon {
        background-color: rgba(255, 255, 255, 0.2);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
    }
    
    .calc-description {
        color: #6c757d;
        margin-bottom: 20px;
        font-style: italic;
    }
    
    .input-group {
        margin-bottom: 15px;
    }
    
    .input-group .form-label {
        font-weight: 500;
        margin-bottom: 5px;
        display: block;
    }
    
    .input-with-unit {
        position: relative;
    }
    
    .input-unit {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: #6c757d;
        font-size: 14px;
    }
    
    .btn-calculate {
        background: linear-gradient(135deg, #0097A7 0%, #006064 100%);
        color: white;
        border: none;
        padding: 8px 20px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
        font-weight: 500;
    }
    
    .btn-calculate:hover {
        background: linear-gradient(135deg, #00ACC1 0%, #0097A7 100%);
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .result-box {
        background-color: #f8f9fa;
        border-left: 4px solid #0097A7;
        padding: 15px;
        margin-top: 20px;
        border-radius: 4px;
        display: none;
    }
    
    .result-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #eee;
    }
    
    .result-item:last-child {
        border-bottom: none;
    }
    
    .result-label {
        font-weight: 500;
    }
    
    .result-value {
        font-weight: 600;
        color: #0097A7;
    }
    
    .category-badge {
        font-size: 0.7rem;
        background-color: rgba(255, 255, 255, 0.2);
        padding: 3px 8px;
        border-radius: 20px;
        margin-left: 10px;
    }
    
    .categoria-producao .calc-header {
        background: linear-gradient(135deg, #00897B 0%, #004D40 100%);
    }
    
    .categoria-brix .calc-header {
        background: linear-gradient(135deg, #F57C00 0%, #E65100 100%);
    }
    
    .categoria-acidez .calc-header {
        background: linear-gradient(135deg, #7B1FA2 0%, #4A148C 100%);
    }
    
    .categoria-outros .calc-header {
        background: linear-gradient(135deg, #455A64 0%, #263238 100%);
    }
    
    .formula-box {
        background-color: #f0f5ff;
        border-radius: 4px;
        padding: 10px 15px;
        margin-bottom: 15px;
        font-family: "Courier New", monospace;
    }
    
    .formula-title {
        font-weight: 600;
        font-size: 0.9rem;
        margin-bottom: 5px;
        color: #0D47A1;
    }
    
    /* Animação de loading */
    .loader {
        display: none;
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 10px;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    /* Paginação de resultados */
    .pagination {
        margin-top: 20px;
        display: flex;
        justify-content: center;
    }
    
    .pagination .page-item {
        margin: 0 5px;
    }
    
    .pagination .page-link {
        color: #0097A7;
    }
    
    .pagination .page-item.active .page-link {
        background-color: #0097A7;
        border-color: #0097A7;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid calculator-container">
    <h2 class="mb-4"><i class="fas fa-calculator me-2"></i> Cálculos Técnicos Avançados</h2>
    
    <!-- Barra de pesquisa e filtro -->
    <div class="calc-filter mb-4">
        <div class="row">
            <div class="col-md-8">
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                    <input type="text" class="form-control" id="calcSearch" placeholder="Pesquisar cálculo...">
                </div>
            </div>
            <div class="col-md-4">
                <select class="form-select" id="calcFilter">
                    <option value="all">Todos os cálculos</option>
                    <option value="producao">Produção</option>
                    <option value="brix">Brix e Açúcar</option>
                    <option value="acidez">Acidez e Ratio</option>
                    <option value="outros">Outros</option>
                </select>
            </div>
        </div>
    </div>
    
    <div class="row" id="calculosContainer">
        <!-- 1. Produção Final (200) -->
        <div class="col-md-6 calculo-item" data-category="producao">
            <div class="calc-card categoria-producao">
                <div class="calc-header">
                    <div>
                        <i class="fas fa-industry me-2"></i> Produção Final (200)
                        <span class="category-badge">Produção</span>
                    </div>
                    <div class="calc-icon">
                        <i class="fas fa-box"></i>
                    </div>
                </div>
                <div class="calc-body">
                    <div class="calc-description">
                        Calcula a produção final considerando perdas durante o processo.
                    </div>
                    
                    <div class="formula-box">
                        <div class="formula-title">Fórmula:</div>
                        <div>Produção Final = Peso Líquido - Perdas</div>
                    </div>
                    
                    <form id="form-producao-final" data-calc="producao-final">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="input-group">
                                    <label class="form-label">Peso Líquido:</label>
                                    <div class="input-with-unit">
                                        <input type="number" class="form-control calc-input" name="peso_liquido" step="0.01" required>
                                        <span class="input-unit">kg</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group">
                                    <label class="form-label">Perdas:</label>
                                    <div class="input-with-unit">
                                        <input type="number" class="form-control calc-input" name="perdas" step="0.01" required>
                                        <span class="input-unit">kg</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="result-box" id="result-producao-final">
                            <div class="result-item">
                                <div class="result-label">Produção Final:</div>
                                <div class="result-value" id="valor-producao-final">0.00 kg</div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="calc-footer">
                    <button type="button" class="btn btn-light me-2 btn-limpar">Limpar</button>
                    <button type="button" class="btn btn-calculate" data-form="form-producao-final">
                        <span class="loader"></span> Calcular
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 2. Produção (Litro) -->
        <div class="col-md-6 calculo-item" data-category="producao">
            <div class="calc-card categoria-producao">
                <div class="calc-header">
                    <div>
                        <i class="fas fa-tint me-2"></i> Produção (Litro)
                        <span class="category-badge">Produção</span>
                    </div>
                    <div class="calc-icon">
                        <i class="fas fa-flask"></i>
                    </div>
                </div>
                <div class="calc-body">
                    <div class="calc-description">
                        Converte a produção de peso (kg) para volume (L) usando a densidade.
                    </div>
                    
                    <div class="formula-box">
                        <div class="formula-title">Fórmula:</div>
                        <div>Produção (L) = Peso Líquido / Densidade</div>
                    </div>
                    
                    <form id="form-producao-litro" data-calc="producao-litro">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="input-group">
                                    <label class="form-label">Peso Líquido:</label>
                                    <div class="input-with-unit">
                                        <input type="number" class="form-control calc-input" name="peso_liquido" step="0.01" required>
                                        <span class="input-unit">kg</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group">
                                    <label class="form-label">Densidade:</label>
                                    <div class="input-with-unit">
                                        <input type="number" class="form-control calc-input" name="densidade" step="0.001" value="1.0" required>
                                        <span class="input-unit">g/mL</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="result-box" id="result-producao-litro">
                            <div class="result-item">
                                <div class="result-label">Produção em Volume:</div>
                                <div class="result-value" id="valor-producao-litro">0.00 L</div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="calc-footer">
                    <button type="button" class="btn btn-light me-2 btn-limpar">Limpar</button>
                    <button type="button" class="btn btn-calculate" data-form="form-producao-litro">
                        <span class="loader"></span> Calcular
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 3. Abaixar Brix -->
        <div class="col-md-6 calculo-item" data-category="brix">
            <div class="calc-card categoria-brix">
                <div class="calc-header">
                    <div>
                        <i class="fas fa-water me-2"></i> Abaixar Brix
                        <span class="category-badge">Brix</span>
                    </div>
                    <div class="calc-icon">
                        <i class="fas fa-tint"></i>
                    </div>
                </div>
                <div class="calc-body">
                    <div class="calc-description">
                        Calcula a quantidade de água necessária para diluir o produto e reduzir o brix para o valor desejado.
                    </div>
                    
                    <div class="formula-box">
                        <div class="formula-title">Fórmula:</div>
                        <div>Água (L) = (Brix Atual - Brix Desejado) × Volume Atual / Brix Desejado</div>
                    </div>
                    
                    <form id="form-abaixar-brix" data-calc="abaixar-brix">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="input-group">
                                    <label class="form-label">Brix Atual:</label>
                                    <div class="input-with-unit">
                                        <input type="number" class="form-control calc-input" name="brix_atual" step="0.1" required>
                                        <span class="input-unit">°Bx</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <label class="form-label">Brix Desejado:</label>
                                    <div class="input-with-unit">
                                        <input type="number" class="form-control calc-input" name="brix_desejado" step="0.1" required>
                                        <span class="input-unit">°Bx</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <label class="form-label">Volume Atual:</label>
                                    <div class="input-with-unit">
                                        <input type="number" class="form-control calc-input" name="volume_atual" step="0.1" required>
                                        <span class="input-unit">L</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="result-box" id="result-abaixar-brix">
                            <div class="result-item">
                                <div class="result-label">Quantidade de Água:</div>
                                <div class="result-value" id="valor-abaixar-brix">0.00 L</div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="calc-footer">
                    <button type="button" class="btn btn-light me-2 btn-limpar">Limpar</button>
                    <button type="button" class="btn btn-calculate" data-form="form-abaixar-brix">
                        <span class="loader"></span> Calcular
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 4. Brix Corrigido -->
        <div class="col-md-6 calculo-item" data-category="brix">
            <div class="calc-card categoria-brix">
                <div class="calc-header">
                    <div>
                        <i class="fas fa-thermometer-half me-2"></i> Brix Corrigido
                        <span class="category-badge">Brix</span>
                    </div>
                    <div class="calc-icon">
                        <i class="fas fa-temperature-high"></i>
                    </div>
                </div>
                <div class="calc-body">
                    <div class="calc-description">
                        Corrige o valor de Brix medido considerando a temperatura da amostra.
                    </div>
                    
                    <div class="formula-box">
                        <div class="formula-title">Fórmula:</div>
                        <div>Brix Corrigido = Brix Medido + 0.002 × (Temperatura - 20)</div>
                    </div>
                    
                    <form id="form-brix-corrigido" data-calc="brix-corrigido">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="input-group">
                                    <label class="form-label">Brix Medido:</label>
                                    <div class="input-with-unit">
                                        <input type="number" class="form-control calc-input" name="brix_medido" step="0.1" required>
                                        <span class="input-unit">°Bx</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group">
                                    <label class="form-label">Temperatura:</label>
                                    <div class="input-with-unit">
                                        <input type="number" class="form-control calc-input" name="temperatura" step="0.1" value="20" required>
                                        <span class="input-unit">°C</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="result-box" id="result-brix-corrigido">
                            <div class="result-item">
                                <div class="result-label">Brix Corrigido:</div>
                                <div class="result-value" id="valor-brix-corrigido">0.00 °Bx</div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="calc-footer">
                    <button type="button" class="btn btn-light me-2 btn-limpar">Limpar</button>
                    <button type="button" class="btn btn-calculate" data-form="form-brix-corrigido">
                        <span class="loader"></span> Calcular
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 5. Densidade -->
        <div class="col-md-6 calculo-item" data-category="outros">
            <div class="calc-card categoria-outros">
                <div class="calc-header">
                    <div>
                        <i class="fas fa-weight me-2"></i> Densidade
                        <span class="category-badge">Outros</span>
                    </div>
                    <div class="calc-icon">
                        <i class="fas fa-vial"></i>
                    </div>
                </div>
                <div class="calc-body">
                    <div class="calc-description">
                        Calcula a densidade de uma substância com base em sua massa e volume.
                    </div>
                    
                    <div class="formula-box">
                        <div class="formula-title">Fórmula:</div>
                        <div>Densidade = Peso / Volume</div>
                    </div>
                    
                    <form id="form-densidade" data-calc="densidade">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="input-group">
                                    <label class="form-label">Peso:</label>
                                    <div class="input-with-unit">
                                        <input type="number" class="form-control calc-input" name="peso" step="0.01" required>
                                        <span class="input-unit">g</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group">
                                    <label class="form-label">Volume:</label>
                                    <div class="input-with-unit">
                                        <input type="number" class="form-control calc-input" name="volume" step="0.01" required>
                                        <span class="input-unit">mL</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="result-box" id="result-densidade">
                            <div class="result-item">
                                <div class="result-label">Densidade:</div>
                                <div class="result-value" id="valor-densidade">0.00 g/mL</div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="calc-footer">
                    <button type="button" class="btn btn-light me-2 btn-limpar">Limpar</button>
                    <button type="button" class="btn btn-calculate" data-form="form-densidade">
                        <span class="loader"></span> Calcular
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Continue adicionando os demais cálculos... Aqui estão apenas 5 exemplos -->
        
        <!-- 6. Ratio -->
        <div class="col-md-6 calculo-item" data-category="acidez">
            <div class="calc-card categoria-acidez">
                <div class="calc-header">
                    <div>
                        <i class="fas fa-balance-scale me-2"></i> Ratio
                        <span class="category-badge">Acidez</span>
                    </div>
                    <div class="calc-icon">
                        <i class="fas fa-divide"></i>
                    </div>
                </div>
                <div class="calc-body">
                    <div class="calc-description">
                        Calcula a relação entre o Brix e a acidez, indicador importante de qualidade.
                    </div>
                    
                    <div class="formula-box">
                        <div class="formula-title">Fórmula:</div>
                        <div>Ratio = Brix / Acidez</div>
                    </div>
                    
                    <form id="form-ratio" data-calc="ratio">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="input-group">
                                    <label class="form-label">Brix:</label>
                                    <div class="input-with-unit">
                                        <input type="number" class="form-control calc-input" name="brix_atual" step="0.1" required>
                                        <span class="input-unit">°Bx</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group">
                                    <label class="form-label">Acidez:</label>
                                    <div class="input-with-unit">
                                        <input type="number" class="form-control calc-input" name="acidez" step="0.01" required>
                                        <span class="input-unit">%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="result-box" id="result-ratio">
                            <div class="result-item">
                                <div class="result-label">Ratio:</div>
                                <div class="result-value" id="valor-ratio">0.00</div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="calc-footer">
                    <button type="button" class="btn btn-light me-2 btn-limpar">Limpar</button>
                    <button type="button" class="btn btn-calculate" data-form="form-ratio">
                        <span class="loader"></span> Calcular
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Adicione os outros 23 cálculos seguindo o mesmo padrão -->
        
    </div>
    
    <!-- Paginação para grandes quantidades de cálculos -->
    <nav aria-label="Navegação de cálculos" class="mt-4 mb-5">
        <ul class="pagination justify-content-center" id="calcPagination">
            <!-- Será preenchido via JavaScript -->
        </ul>
    </nav>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Função para calcular os resultados
    const calcularResultado = function(formId) {
        const form = document.getElementById(formId);
        const resultBox = document.getElementById('result-' + form.dataset.calc);
        const tipo = form.dataset.calc;
        
        // Obter valores dos campos
        const formData = new FormData(form);
        const dados = Object.fromEntries(formData.entries());
        
        // Converter valores para números
        for (let key in dados) {
            dados[key] = parseFloat(dados[key]) || 0;
        }
        
        // Calcular baseado no tipo
        let resultado = 0;
        let unidade = '';
        
        switch(tipo) {
            case 'producao-final':
                resultado = dados.peso_liquido - dados.perdas;
                unidade = 'kg';
                document.getElementById('valor-producao-final').textContent = resultado.toFixed(2) + ' ' + unidade;
                break;
                
            case 'producao-litro':
                if (dados.densidade !== 0) {
                    resultado = dados.peso_liquido / dados.densidade;
                    unidade = 'L';
                    document.getElementById('valor-producao-litro').textContent = resultado.toFixed(2) + ' ' + unidade;
                }
                break;
                
            case 'abaixar-brix':
                if (dados.brix_desejado !== 0) {
                    resultado = ((dados.brix_atual - dados.brix_desejado) * dados.volume_atual) / dados.brix_desejado;
                    unidade = 'L';
                    document.getElementById('valor-abaixar-brix').textContent = resultado.toFixed(2) + ' ' + unidade;
                }
                break;
                
            case 'brix-corrigido':
                const fator_correcao = 0.002 * (dados.temperatura - 20);
                resultado = dados.brix_medido + fator_correcao;
                unidade = '°Bx';
                document.getElementById('valor-brix-corrigido').textContent = resultado.toFixed(2) + ' ' + unidade;
                break;
                
            case 'densidade':
                if (dados.volume !== 0) {
                    resultado = dados.peso / dados.volume;
                    unidade = 'g/mL';
                    document.getElementById('valor-densidade').textContent = resultado.toFixed(3) + ' ' + unidade;
                }
                break;
                
            case 'ratio':
                if (dados.acidez !== 0) {
                    resultado = dados.brix_atual / dados.acidez;
                    document.getElementById('valor-ratio').textContent = resultado.toFixed(2);
                }
                break;
                
            // Adicionar cases para os outros cálculos...
        }
        
        // Mostrar resultado
        resultBox.style.display = 'block';
    };
    
    // Event listeners para botões de calcular
    document.querySelectorAll('.btn-calculate').forEach(button => {
        button.addEventListener('click', function() {
            const formId = this.getAttribute('data-form');
            calcularResultado(formId);
        });
    });
    
    // Event listeners para limpar formulários
    document.querySelectorAll('.btn-limpar').forEach(button => {
        button.addEventListener('click', function() {
            const form = this.closest('.calc-card').querySelector('form');
            form.reset();
            const resultBox = form.querySelector('.result-box');
            if (resultBox) resultBox.style.display = 'none';
        });
    });
    
    // Filtro de pesquisa
    const searchInput = document.getElementById('calcSearch');
    searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        
        document.querySelectorAll('.calculo-item').forEach(item => {
            const text = item.textContent.toLowerCase();
            if (text.includes(searchTerm)) {
                item.style.display = '';
            } else {
                item.style.display = 'none';
            }
        });
    });
    
    // Filtro por categoria
    const categoryFilter = document.getElementById('calcFilter');
    categoryFilter.addEventListener('change', function() {
        const category = this.value;
        
        document.querySelectorAll('.calculo-item').forEach(item => {
            if (category === 'all' || item.getAttribute('data-category') === category) {
                item.style.display = '';
            } else {
                item.style.display = 'none';
            }
        });
    });
});
</script>
{% endblock %}